(function(a,b,c){a.endpoints={events:""};a.useGeoLocation=false;a.position=null;a.centerpoint=null;a.geocodedAddr="";a.isSearching=false;a.isGeolocating=false;a.searchParams={};a.$search=null;a.getUserPosition=function(d){if(this.isGeolocating===true){return}var e=this;if(navigator.geolocation){e.isGeolocating=true;navigator.geolocation.getCurrentPosition(function(f){e.position=f;e.useGeoLocation=true;b("input[name=saddr]").attr("placeholder","Your current location");e.centerpoint=new google.maps.LatLng(e.position.coords.latitude,e.position.coords.longitude);e.isGeolocating=false;if(d===true){e.searchLocationsNear()}},function(f){e.useGeoLocation=false;e.isGeolocating=false;switch(f.code){case f.PERMISSION_DENIED:alert("Geolocation failed: You denied the request for Geolocation.");break;case f.POSITION_UNAVAILABLE:alert("Geolocation failed: Location information is unavailable.");break;case f.TIMEOUT:alert("Geolocation failed: The request to get your location timed out.");break;case f.UNKNOWN_ERROR:alert("Geolocation failed: An unknown error occurred.");break}})}else{this.useGeoLocation=false;this.isGeolocating=false}};a.searchLocations=function(){var g=b("#addressInput");var d=g.val();if(typeof d.trim==="function"){d=d.trim()}var e=this;if(d.length<=0&&this.useGeoLocation===true&&this.isGeolocating===false){this.getUserPosition(true)}else{if(d===this.geocodedAddr){this.searchLocationsNear()}else{var f=new google.maps.Geocoder();f.geocode({address:d},function(i,h){if(h===google.maps.GeocoderStatus.OK){e.centerpoint=i[0].geometry.location;e.geocodedAddr=d;e.searchLocationsNear()}else{alert(d+" not found")}})}}};a.searchLocationsNear=function(){if(this.isSearching===true){return}var e=this;var d=this.getFilterOptions();if(d===false){return}this.isSearching=true;b.ajax({url:this.endpoints.events,type:"GET",dataType:"html",data:e.searchParams,success:function(f,g,j){var h=b(f);h.hide();var i=e.$search.parent();e.$search.fadeOut(333,function(){e.$search.remove();i.append(h);h.fadeIn(666,function(){e.$search=h})});e.isSearching=false;e.showButtons();if(b(window).width()>767){i.ScrollTo({offsetTop:60})}else{i.ScrollTo()}},error:function(h,f,g){window.setTimeout(function(){e.isSearching=false;e.showButtons();utilities.ajaxError.show("Event Search","Failed to retrieve data",h,f,g)},1000)}})};a.getFilterOptions=function(){var e=b("#searchForm :input");var f=this;var d={};e.each(function(){if(this.name!==""&&b(this).val()!==null&&b(this).val()!==""){if(typeof b(this).val()==="string"){var j=b(this).val();if(typeof j.trim==="function"){j=j.trim()}if(this.name==="start_date"||this.name==="end_date"){var h=moment(j,"MM/DD/YYYY");if(h.isValid()!==false){d[this.name]=h.format("YYYY-MM-DD")}}else{if(this.name==="start_time"||this.name==="end_time"){var h=moment(j,"hh:mm A");if(h.isValid()!==false){d[this.name]=h.format("HH:mm:ss")}}else{if(this.name==="radius"){var g=parseInt(j,10);if(g!=="NaN"){d[this.name]=g}}else{if(this.name==="limit"){var g=parseInt(j,10);if(g!=="NaN"){d[this.name]=g}}else{if(this.name==="price"){var i=parseFloat(j,10);if(i!=="NaN"){d[this.name]=i.toFixed(2)}}else{d[this.name]=j}}}}}}else{d[this.name]=b(this).val()}}});f.searchParams=d;f.searchParams.lat=(f.centerpoint)?f.centerpoint.lat():0;f.searchParams.lng=(f.centerpoint)?f.centerpoint.lng():0;return d!=={}};a.onReady=function(){var d=this;b("#eventPrice").inputmask("decimal",{placeholder:"$0.00",autoUnmask:true,digits:2,groupSeparator:",",radixPoint:".",autoGroup:true,rightAlignNumerics:true,clearMaskOnLostFocus:true,clearIncomplete:true,showTooltip:true});b.fn.datetimepicker.defaults={maskInput:true,pick12HourFormat:true,pickSeconds:false,startDate:moment().startOf("day").toDate(),endDate:moment().add("days",365).endOf("day").toDate()};b("#searchDate").datetimepicker({pickDate:true,pickTime:false});b("#searchDateEnd").datetimepicker({pickDate:true,pickTime:false});b("#searchTime").datetimepicker({pickDate:false,pickTime:true,maskInput:true,pick12HourFormat:true,pickSeconds:false});b("#searchTimeEnd").datetimepicker({pickDate:false,pickTime:true,maskInput:true,pick12HourFormat:true,pickSeconds:false});b('[data-toggle="tooltip"]').tooltip();b("#searchFilterButton").on("click",function(f){f.preventDefault();b("#searchFilterDiv").slideToggle(400)});b("#searchForm").on("submit",function(f){f.preventDefault();if(d.isSearching===true){return false}d.hideButtons();d.searchLocations()});this.getUserPosition()};a.hideButtons=function(){var d=b("#searchButtons > button");var f=b("#searchButtons");var e='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';f.append(e);d.filter(":visible").hide()};a.showButtons=function(){var d=b("#searchButtons > button");var e=b("#searchButtons > #loading");d.filter(":hidden").show();e.remove()}}(window.eventSearch=window.eventSearch||{},jQuery));