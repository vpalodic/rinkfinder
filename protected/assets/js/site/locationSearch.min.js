(function(a,b,c){a.endpoints={markers:""};a.useGeoLocation=false;a.position=null;a.searchResults=[];a.map=null;a.markers=[];a.infoWindow=null;a.centerpoint=null;a.geocodedAddr="";a.isSearching=false;a.isGeolocating=false;a.searchParams={};a.getUserPosition=function(d){if(this.isGeolocating===true){return}var e=this;if(navigator.geolocation){e.isGeolocating=true;navigator.geolocation.getCurrentPosition(function(f){e.position=f;e.useGeoLocation=true;b("input[name=saddr]").attr("placeholder","Your current location");e.centerpoint=new google.maps.LatLng(e.position.coords.latitude,e.position.coords.longitude);e.isGeolocating=false;if(d===true){e.searchLocationsNear()}},function(f){e.useGeoLocation=false;e.isGeolocating=false;switch(f.code){case f.PERMISSION_DENIED:alert("Geolocation failed: You denied the request for Geolocation.");break;case f.POSITION_UNAVAILABLE:alert("Geolocation failed: Location information is unavailable.");break;case f.TIMEOUT:alert("Geolocation failed: The request to get your location timed out.");break;case f.UNKNOWN_ERROR:alert("Geolocation failed: An unknown error occurred.");break}})}else{this.useGeoLocation=false;this.isGeolocating=false}};a.initMap=function(){if(typeof this.centerpoint==="undefined"||this.centerpoint===null){this.centerpoint=new google.maps.LatLng(44.9833,-93.2667)}var d=b("#searchResultsWell");if(d.hasClass("hidden")){d.removeClass("hidden")}if(typeof this.map==="undefined"||this.map===null){this.map=new google.maps.Map(document.getElementById("map-canvas"),{center:this.centerpoint,zoom:12,mapTypeId:google.maps.MapTypeId.HYBRID})}if(typeof this.infoWindow==="undefined"||this.infoWindow===null){this.infoWindow=new google.maps.InfoWindow()}this.clearLocations()};a.setupMarkers=function(){var h=new google.maps.LatLngBounds();var g=this;for(var e=0;e<this.searchResults.length;e++){var j=new google.maps.LatLng(parseFloat(this.searchResults[e].lat),parseFloat(this.searchResults[e].lng));this.createMarker(j,this.searchResults[e],e);h.extend(j)}if(this.searchResults.length>0){this.map.fitBounds(h);b("#locationSelect").off("change");b("#locationSelect").on("change",function(k){var i=b("#locationSelect").val();if(i!=="none"){google.maps.event.trigger(g.markers[i],"click")}});b("#locationList").off("click","li");b("#locationList").on("click","li",function(k){var i=b(this).data("markerIndex");if(typeof i!=="undefined"&&i!=="none"){google.maps.event.trigger(g.markers[i],"click")}})}else{this.map.panTo(this.centerpoint);this.map.setZoom(8);b("#locationSelect").empty();b("#locationList").empty();var d="<li data-marker-index='none'><h3>No Facilities Found</h3><p>There were no facilities found that matched your search filter.</p></li>";var f="<option value='none'>No Facilities Found</option>";b("#locationSelect").append(f);b("#locationList").append(d)}};a.searchLocations=function(){var g=b("#addressInput");var d=g.val();if(typeof d.trim==="function"){d=d.trim()}var e=this;if(d.length<=0&&this.useGeoLocation===true&&this.isGeolocating===false){this.getUserPosition(true)}else{if(d===this.geocodedAddr){this.searchLocationsNear()}else{var f=new google.maps.Geocoder();f.geocode({address:d},function(i,h){if(h===google.maps.GeocoderStatus.OK){e.centerpoint=i[0].geometry.location;e.geocodedAddr=d;e.searchLocationsNear()}else{alert(d+" not found")}})}}};a.searchLocationsNear=function(){if(this.isSearching===true){return}var e=this;this.clearLocations();var d=this.getFilterOptions();if(d===false){return}this.isSearching=true;b.ajax({url:this.endpoints.markers,type:"GET",dataType:"json",data:e.searchParams,success:function(f,g,h){e.searchResults=[];e.searchResults=f.data;e.setupMarkers();e.isSearching=false;e.showButtons();if(b(window).width()>767){b("#searchResultsWell").ScrollTo({offsetTop:60})}else{b("#searchResultsWell").ScrollTo()}},error:function(h,f,g){window.setTimeout(function(){e.isSearching=false;e.showButtons();utilities.ajaxError.show("Location Search","Failed to retrieve data",h,f,g)},1000)}})};a.clearLocations=function(){if(this.infoWindow!==null){this.infoWindow.close()}for(var d=0;d<this.markers.length;d++){this.markers[d].setMap(null)}this.markers.length=0;this.searchResults.length=0;b("#locationSelect").empty();b("#locationList").empty();var e="<option value='none'>See all results</option>";b("#locationSelect").append(e)};a.createMarker=function(i,d,e){var f=this.createInfoWindow(d);var g=this;this.addLocationListItem(d,e);this.addLocationSelectItem(d,e);f="<div class='infowindow'>"+f+"</div>";var h=new google.maps.Marker({map:g.map,position:i});google.maps.event.addListener(h,"click",function(){g.infoWindow.setContent(f);g.infoWindow.open(g.map,h)});this.markers.push(h)};a.createInfoWindow=function(d){var e='<div class="accordion" id="accordionInfoWindow">';if(typeof d.events!=="undefined"&&d.events!==null&&d.events.length>0){e+='<div class="accordion-group"><div class="accordion-heading"><a class="accordion-toggle" data-toggle="collapse" data-parent="#accordionInfoWindow" href="#collapseInfoWindowThree">Facility Events</a></div>';e+='<div id="collapseInfoWindowThree" class="accordion-body collapse in"><div class="accordion-inner">';e+="<h5><a href='"+d.events_url+"'>Event Calendar</a></h5>";for(var f=0;f<d.events.length;f++){e+="<address><strong><a href='"+d.events[f].event_view_url+"'>"+d.events[f].event_type_name+"</a></strong><br />";e+="Found: "+d.events[f].event_count+"<br />";e+="Earliest: "+d.events[f].start_date_time+"</address>"}e+="</div></div></div>"}else{if(typeof d.events_url!=="undefined"&&d.events_url!==null&&d.events_url.length>0){e+="<h5><a href='"+d.events_url+"'>Event Calendar</a></h5>"}}e+='<div class="accordion-group"><div class="accordion-heading"><a class="accordion-toggle" data-toggle="collapse" data-parent="#accordionInfoWindow" href="#collapseInfoWindowOne">Facility Details</a></div>';e+='<div id="collapseInfoWindowOne" class="accordion-body collapse in"><div class="accordion-inner">';e+="<h5><a href='"+d.view_url+"'>"+d.arena_name+"</a></h5><small><strong>"+parseFloat(d.distance).toFixed(2)+"</strong> miles</small><br />";if(this.geocodedAddr===""){if(typeof d.address_line2!=="undefined"&&d.address_line2!==null&&d.address_line2.length>0){e+='<a target="_blank" href="http://maps.google.com/?q='+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+"&daddr="+escape(d.address_line1+", "+d.address_line2+","+d.city_state_zip)+"&saddr="+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+'">Driving Directions</a>'}else{e+='<a target="_blank" href="http://maps.google.com/?q='+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+"&daddr="+escape(d.address_line1+", "+d.city_state_zip)+"&saddr="+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+'">Driving Directions</a>'}}else{if(typeof d.address_line2!=="undefined"&&d.address_line2!==null&&d.address_line2.length>0){e+='<a target="_blank" href="http://maps.google.com/?q='+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+"&daddr="+escape(d.address_line1+", "+d.address_line2+","+d.city_state_zip)+"&saddr="+escape(this.geocodedAddr)+'">Driving Directions</a>'}else{e+='<a target="_blank" href="http://maps.google.com/?q='+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+"&daddr="+escape(d.address_line1+", "+d.city_state_zip)+"&saddr="+escape(this.geocodedAddr)+'">Driving Directions</a>'}}e+="<address>"+d.address_line1+"<br />";if(typeof d.address_line2!=="undefined"&&d.address_line2!==null&&d.address_line2.length>0){e+=d.address_line2+"<br />"}e+=d.city_state_zip+"<br />";if(typeof d.phone!=="undefined"&&d.phone!==null&&d.phone.length>0){e+='<abbr title="Phone">P:</abbr> '+d.phone.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");if(typeof d.ext!=="undefined"&&d.ext!==null&&d.ext.length>0){e+=' <abbr title="Extension">E:</abbr> '+d.ext+"<br />"}else{e+="<br />"}}if(typeof d.fax!=="undefined"&&d.fax!==null&&d.fax.length>0){e+='<abbr title="Fax">F:</abbr> '+d.fax.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");if(typeof d.fax_ext!=="undefined"&&d.fax_ext!==null&&d.fax_ext.length>0){e+=' <abbr title="Fax Extension">E:</abbr> '+d.fax_ext+"<br />"}else{e+="<br />"}}if(typeof d.home_url!=="undefined"&&d.home_url!==null&&d.home_url.length>0){e+='<abbr title="Home Page">H:</abbr> <a target="_blank" href="'+d.home_url+'">Home Page</a><br />'}e+="</address></div></div></div>";if(typeof d.contacts!=="undefined"&&d.contacts!==null&&d.contacts.length>0){e+='<div class="accordion-group"><div class="accordion-heading"><a class="accordion-toggle" data-toggle="collapse" data-parent="#accordionInfoWindow" href="#collapseInfoWindowTwo">Facility Contacts</a></div>';e+='<div id="collapseInfoWindowTwo" class="accordion-body collapse"><div class="accordion-inner">';for(var f=0;f<d.contacts.length;f++){if(d.contacts[f].contact_type==="Primary"){e+="<address><abbr title='Primary Contact'>*:</abbr> <strong>"+d.contacts[f].contact_name+"</strong><br />"}else{e+="<address>"+d.contacts[f].contact_name+"<br />"}if(typeof d.contacts[f].contact_phone!=="undefined"&&d.contacts[f].contact_phone!==null&&d.contacts[f].contact_phone.length>0){e+='<abbr title="Phone">P:</abbr> '+d.contacts[f].contact_phone.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");if(typeof d.contacts[f].contact_ext!=="undefined"&&d.contacts[f].contact_ext!==null&&d.contacts[f].contact_ext.length>0){e+=' <abbr title="Extension">E:</abbr> '+d.contacts[f].contact_ext+"<br />"}else{e+="<br />"}}if(typeof d.contacts[f].contact_fax!=="undefined"&&d.contacts[f].contact_fax!==null&&d.contacts[f].contact_fax.length>0){e+='<abbr title="Fax">F:</abbr> '+d.contacts[f].contact_fax.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");if(typeof d.contacts[f].contact_fax_ext!=="undefined"&&d.contacts[f].contact_fax_ext!==null&&d.contacts[f].contact_fax_ext.length>0){e+=' <abbr title="Fax Extension">E:</abbr> '+d.contacts[f].contact_fax_ext+"<br />"}else{e+="<br />"}}if(typeof d.contacts[f].contact_email!=="undefined"&&d.contacts[f].contact_email!==null&&d.contacts[f].contact_email.length>0){e+='<abbr title="Email Address">M:</abbr> <a href="mailto:'+d.contacts[f].contact_email+'">'+d.contacts[f].contact_email+"</a><br />"}e+="</address>"}e+="</div></div></div>"}e+="</div>";return e};a.addLocationListItem=function(d,g){var f=b("#locationList");var e="<li data-marker-index='"+g+"'><h5><a href='"+d.view_url+"'>"+d.arena_name+"</a></h5><small><strong>"+parseFloat(d.distance).toFixed(2)+"</strong> miles</small><p>";if(this.geocodedAddr===""){if(typeof d.address_line2!=="undefined"&&d.address_line2!==null&&d.address_line2.length>0){e+='<a target="_blank" href="http://maps.google.com/?q='+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+"&daddr="+escape(d.address_line1+", "+d.address_line2+","+d.city_state_zip)+"&saddr="+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+'">Driving Directions</a>'}else{e+='<a target="_blank" href="http://maps.google.com/?q='+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+"&daddr="+escape(d.address_line1+", "+d.city_state_zip)+"&saddr="+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+'">Driving Directions</a>'}}else{if(typeof d.address_line2!=="undefined"&&d.address_line2!==null&&d.address_line2.length>0){e+='<a target="_blank" href="http://maps.google.com/?q='+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+"&daddr="+escape(d.address_line1+", "+d.address_line2+","+d.city_state_zip)+"&saddr="+escape(this.geocodedAddr)+'">Driving Directions</a>'}else{e+='<a target="_blank" href="http://maps.google.com/?q='+escape(this.centerpoint.lat()+","+this.centerpoint.lng())+"&daddr="+escape(d.address_line1+", "+d.city_state_zip)+"&saddr="+escape(this.geocodedAddr)+'">Driving Directions</a>'}}e+="<address>";e+=d.address_line1+"<br />";if(typeof d.address_line2!=="undefined"&&d.address_line2!==null&&d.address_line2.length>0){e+=d.address_line2+"<br />"}e+=d.city_state_zip+"<br />";if(typeof d.phone!=="undefined"&&d.phone!==null&&d.phone.length>0){e+='<abbr title="Phone">P:</abbr> '+d.phone.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");if(typeof d.ext!=="undefined"&&d.ext!==null&&d.ext.length>0){e+=' <abbr title="Extension">E:</abbr> '+d.ext+"<br />"}else{e+="<br />"}}if(typeof d.fax!=="undefined"&&d.fax!==null&&d.fax.length>0){e+='<abbr title="Fax">F:</abbr> '+d.fax.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");if(typeof d.fax_ext!=="undefined"&&d.fax_ext!==null&&d.fax_ext.length>0){e+=' <abbr title="Fax Extension">E:</abbr> '+d.fax_ext+"<br />"}else{e+="<br />"}}if(typeof d.home_url!=="undefined"&&d.home_url!==null&&d.home_url.length>0){e+='<abbr title="Home Page">H:</abbr> <a target="_blank" href="'+d.home_url+'">Home Page</a><br />'}e+="</address>";if(typeof d.contacts!=="undefined"&&d.contacts!==null&&d.contacts.length>0){e+="<h5>Contacts</h5>";for(var h=0;h<d.contacts.length;h++){if(d.contacts[h].contact_type==="Primary"){e+="<address><abbr title='Primary Contact'>*:</abbr> <strong>"+d.contacts[h].contact_name+"</strong><br />"}else{e+="<address>"+d.contacts[h].contact_name+"<br />"}if(typeof d.contacts[h].contact_phone!=="undefined"&&d.contacts[h].contact_phone!==null&&d.contacts[h].contact_phone.length>0){e+='<abbr title="Phone">P:</abbr> '+d.contacts[h].contact_phone.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");if(typeof d.contacts[h].contact_ext!=="undefined"&&d.contacts[h].contact_ext!==null&&d.contacts[h].contact_ext.length>0){e+=' <abbr title="Extension">E:</abbr> '+d.contacts[h].contact_ext+"<br />"}else{e+="<br />"}}if(typeof d.contacts[h].contact_fax!=="undefined"&&d.contacts[h].contact_fax!==null&&d.contacts[h].contact_fax.length>0){e+='<abbr title="Fax">F:</abbr> '+d.contacts[h].contact_fax.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");if(typeof d.contacts[h].contact_fax_ext!=="undefined"&&d.contacts[h].contact_fax_ext!==null&&d.contacts[h].contact_fax_ext.length>0){e+=' <abbr title="Fax Extension">E:</abbr> '+d.contacts[h].contact_fax_ext+"<br />"}else{e+="<br />"}}if(typeof d.contacts[h].contact_email!=="undefined"&&d.contacts[h].contact_email!==null&&d.contacts[h].contact_email.length>0){e+='<abbr title="Email Address">M:</abbr> <a href="mailto:'+d.contacts[h].contact_email+'">'+d.contacts[h].contact_email+"</a><br />"}e+="</address>"}}if(typeof d.events!=="undefined"&&d.events!==null&&d.events.length>0){e+="<h5><a href='"+d.events_url+"'>Event Calendar</a></h5>";for(var h=0;h<d.events.length;h++){e+="<address><strong><a href='"+d.events[h].event_view_url+"'>"+d.events[h].event_type_name+"</a></strong><br />";e+="Available: "+d.events[h].start_date_time+"<br />";e+="Total: "+d.events[h].event_count+"<br /></address>"}}else{if(typeof d.events_url!=="undefined"&&d.events_url!==null&&d.events_url.length>0){e+="<h5><a href='"+d.events_url+"'>Event Calendar</a></h5>"}}e+="</p></li>";f.append(e)};a.addLocationSelectItem=function(d,g){var f=b("#locationSelect");var e="<option value='"+g+"'>"+d.arena_name+" ("+parseFloat(d.distance).toFixed(2)+" mi)</option>";f.append(e)};a.getFilterOptions=function(){var e=b("#searchForm :input");var f=this;var d={};e.each(function(){if(this.name!==""&&b(this).val()!==null&&b(this).val()!==""){if(typeof b(this).val()==="string"){var j=b(this).val();if(typeof j.trim==="function"){j=j.trim()}if(this.name==="start_date"||this.name==="end_date"){var h=moment(j,"MM/DD/YYYY");if(h.isValid()!==false){d[this.name]=h.format("YYYY-MM-DD")}}else{if(this.name==="start_time"||this.name==="end_time"){var h=moment(j,"hh:mm A");if(h.isValid()!==false){d[this.name]=h.format("HH:mm:ss")}}else{if(this.name==="radius"){var g=parseInt(j,10);if(g!=="NaN"){d[this.name]=g}}else{if(this.name==="price"){var i=parseFloat(j,10);if(i!=="NaN"){d[this.name]=i.toFixed(2)}}else{d[this.name]=j}}}}}else{d[this.name]=b(this).val()}}});f.searchParams=d;f.searchParams.lat=(f.centerpoint)?f.centerpoint.lat():0;f.searchParams.lng=(f.centerpoint)?f.centerpoint.lng():0;return d!=={}};a.onReady=function(){var f=this;var d=b("#searchResultsWell");var g=b("body");var e=b("#searchResults");var i=b("#map-canvas");e.height(b(window).height()*0.9);b("#locationList").parent().height(b(window).height()*0.85);i.parent().height(b(window).height()*0.85);if(b(window).width()<=767){if(d.css("padding-top")!=="0px"){d.css("padding-top","0px");d.css("padding-right","0px");d.css("padding-bottom","0px");d.css("padding-left","0px")}if(g.css("padding-right")!=="0px"){g.css("padding-left","0px");g.css("padding-right","0px");b(".navbar-fixed-top").css("margin-left","0px");b(".navbar-fixed-top").css("margin-right","0px")}if(d.css("magin-bottom")!=="0px"){d.css("margin-bottom","0px")}e.height(b(window).height());i.parent().height(e.height()-52)}else{if(d.css("padding-top")=="0px"){d.css("padding-top","9px");d.css("padding-right","9px");d.css("padding-bottom","9px");d.css("padding-left","9px")}if(g.css("padding-right")=="0px"){g.css("padding-left","20px");g.css("padding-right","20px")}if(d.css("magin-bottom")=="0px"){d.css("margin-bottom","20px")}e.height(b(window).height()*0.9);b("#locationList").parent().height(b(window).height()-60);i.parent().height(b(window).height()-60)}b(window).on("resize",function(j){if(b(window).width()<=767){if(d.css("padding-top")!=="0px"){d.css("padding-top","0px");d.css("padding-right","0px");d.css("padding-bottom","0px");d.css("padding-left","0px")}if(g.css("padding-right")!=="0px"){g.css("padding-left","0px");g.css("padding-right","0px");b(".navbar-fixed-top").css("margin-left","0px");b(".navbar-fixed-top").css("margin-right","0px")}if(d.css("magin-bottom")!=="0px"){d.css("margin-bottom","0px")}e.height(b(window).height());i.parent().height(e.height()-52)}else{if(d.css("padding-top")=="0px"){d.css("padding-top","9px");d.css("padding-right","9px");d.css("padding-bottom","9px");d.css("padding-left","9px")}if(g.css("padding-right")=="0px"){g.css("padding-left","20px");g.css("padding-right","20px")}if(d.css("magin-bottom")=="0px"){d.css("margin-bottom","20px")}e.height(b(window).height()*0.9);b("#locationList").parent().height(b(window).height()-60);i.parent().height(b(window).height()-60)}});b("#eventPrice").inputmask("decimal",{placeholder:"$0.00",autoUnmask:true,digits:2,groupSeparator:",",radixPoint:".",autoGroup:true,rightAlignNumerics:true,clearMaskOnLostFocus:true,clearIncomplete:true,showTooltip:true});b.fn.datetimepicker.defaults={maskInput:true,pick12HourFormat:true,pickSeconds:false,startDate:moment().startOf("day").toDate(),endDate:moment().add("days",365).endOf("day").toDate()};b("#searchDate").datetimepicker({pickDate:true,pickTime:false});b("#searchDateEnd").datetimepicker({pickDate:true,pickTime:false});b("#searchTime").datetimepicker({pickDate:false,pickTime:true,maskInput:true,pick12HourFormat:true,pickSeconds:false});b("#searchTimeEnd").datetimepicker({pickDate:false,pickTime:true,maskInput:true,pick12HourFormat:true,pickSeconds:false});b('[data-toggle="tooltip"]').tooltip();b("#map-canvas").on("destroyed",function(){a.clearLocations();a.map=null;a.infoWindow=null;a.centerpoint=null;b(".bootstrap-datetimepicker-widget").each(function(){b(this).remove()})});b("#searchFilterButton").on("click",function(j){j.preventDefault();b("#searchFilterDiv").slideToggle(400)});b("#searchForm").on("submit",function(j){j.preventDefault();if(f.isSearching===true){return false}b("input[name=submit]").val(true);f.hideButtons();f.searchLocations()});var h=utilities.getUrlVars();this.initMap();this.getUserPosition()};a.hideButtons=function(){var d=b("#searchButtons > button");var f=b("#searchButtons");var e='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';f.append(e);d.filter(":visible").hide()};a.showButtons=function(){var d=b("#searchButtons > button");var e=b("#searchButtons > #loading");d.filter(":hidden").show();e.remove()}}(window.locationSearch=window.locationSearch||{},jQuery));