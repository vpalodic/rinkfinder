(function(a,b){if(typeof exports==="object"){module.exports=b(require("moment"))}else{if(typeof define==="function"&&define.amd){define("moment-recur",["moment"],b)}else{a.moment=b(a.moment)}}}(this,function(c){var e;e=(typeof module!=="undefined"&&module!==null)&&(module.exports!=null);if(typeof c==="undefined"){throw Error("Can't find moment")}var b=(function(){function g(h,i){for(var j in h){if(h.hasOwnProperty(j)){if(parseInt(j,10)<=0){throw Error("Intervals must be greater than zero")}}}return{measure:i.toLowerCase(),units:h}}function f(j,h,m,i){var l=m.diff(i,j,true);for(var k in h){if(h.hasOwnProperty(k)){k=parseInt(k,10);if((l%k)===0){return true}}}return false}return{create:g,match:f}})();var d=(function(){var k={daysOfMonth:"date",daysOfWeek:"day",weeksOfMonth:"monthWeek",weeksOfYear:"weeks",monthsOfYear:"months"};var g={daysOfMonth:{low:1,high:31},daysOfWeek:{low:0,high:6},weeksOfMonth:{low:0,high:4},weeksOfYear:{low:0,high:52},monthsOfYear:{low:0,high:11}};function f(l,n,m){m.forEach(function(o){if(o<l||o>n){throw Error("Value should be in range "+l+" to "+n)}})}function j(p,o){var m,n,q;var l={};for(m in p){if(p.hasOwnProperty(m)){n=parseInt(m,10);if(isNaN(n)){n=m}q=c().set(o,n).get(o);l[q]=p[m]}}return l}function h(o,m){var n=[];if(m==="daysOfWeek"){o=j(o,"days")}if(m==="monthsOfYear"){o=j(o,"months")}for(var l in o){if(hasOwnProperty.call(o,l)){n.push(l)}}f(g[m].low,g[m].high,n);return{measure:m,units:o}}function i(n,p,m){var l=k[n];var o=m[l]();if(p[o]){return true}return false}return{create:h,match:i}})();var a=(function(){var k={days:"interval",weeks:"interval",months:"interval",years:"interval",daysOfWeek:"calendar",daysOfMonth:"calendar",weeksOfMonth:"calendar",weeksOfYear:"calendar",monthsOfYear:"calendar"};var g={days:"day",weeks:"week",months:"month",years:"year",daysOfWeek:"dayOfWeek",daysOfMonth:"dayOfMonth",weeksOfMonth:"weekOfMonth",weeksOfYear:"weekOfYear",monthsOfYear:"monthOfYear"};function h(){var s;var t=k[this.measure];if(!(this instanceof l)){throw Error("Private method trigger() was called directly or not called as instance of Recur!")}if((typeof this.units==="undefined"||this.units===null)||!this.measure){return this}if(t!=="calendar"&&t!=="interval"){throw Error("Invlid measure provided: "+this.measure)}if(t==="interval"){if(!this.start){throw Error("Must have a start date set to set an interval!")}s=b.create(this.units,this.measure)}if(t==="calendar"){s=d.create(this.units,this.measure)}this.units=null;this.measure=null;for(var r=0;r<this.rules.length;r++){if(this.rules[r].measure===s.measure){this.rules.splice(r,1)}}this.rules.push(s);return this}function n(t,w,u){var r,s;var v=[];if(!(this instanceof l)){throw Error("Private method trigger() was called directly or not called as instance of Recur!")}if(!this.start&&!this.from){throw Error("Cannot get occurances without start or from date.")}r=(this.from||this.start).clone();while(v.length<t){if(u==="next"){r.add(1,"day")}else{r.subtract(1,"day")}console.log("Match: "+r.format("L")+" - "+this.matches(r,true));if(this.matches(r,true)){s=w?r.format(w):r.clone();v.push(s)}}return v}function o(t,r,s){if(t&&s.isBefore(t)){return false}if(r&&s.isAfter(r)){return false}return true}function m(r){var s={};if(Object.prototype.toString.call(r)=="[object Array]"){r.forEach(function(t){s[t]=true})}else{if(r===Object(r)){s=r}else{if((Object.prototype.toString.call(r)=="[object Number]")||(Object.prototype.toString.call(r)=="[object String]")){s[r]=true}else{throw Error("Provide an array, object, string or number when passing units!")}}}return s}function j(u,s){for(var t=0,r=u.length;t<r;t++){if(c(u[t]).isSame(s)){return true}}return false}function q(r){switch(r){case"day":return"days";case"week":return"weeks";case"month":return"months";case"year":return"years";case"dayOfWeek":return"daysOfWeek";case"dayOfMonth":return"daysOfMonth";case"weekOfMonth":return"weeksOfMonth";case"weekOfYear":return"weeksOfYear";case"monthOfYear":return"monthsOfYear";default:return r}}function i(w,s,x){var t,r,v,u;for(t=0,r=w.length;t<r;t++){v=w[t];u=k[v.measure];if(u==="interval"){if(!b.match(v.measure,v.units,x,s)){return false}}else{if(u==="calendar"){if(!d.match(v.measure,v.units,s)){return false}}else{return false}}}return true}function p(r){return function(s){this.every.call(this,s,r);return this}}var l=function(r){if(r.start){this.start=c(r.start).dateOnly()}if(r.end){this.end=c(r.end).dateOnly()}this.rules=r.rules||[];this.exceptions=r.exceptions||[];this.units=null;this.measure=null;this.from=null;return this};l.prototype.startDate=function(r){if(r===null){this.start=null;return this}if(r){this.start=c(r).dateOnly();return this}return this.start};l.prototype.endDate=function(r){if(r===null){this.end=null;return this}if(r){this.end=c(r).dateOnly();return this}return this.end};l.prototype.fromDate=function(r){if(r===null){this.from=null;return this}if(r){this.from=c(r).dateOnly();return this}return this.from};l.prototype.save=function(){var t={};if(this.start&&c(this.start).isValid()){t.start=this.start.format("L")}if(this.end&&c(this.end).isValid()){t.end=this.end.format("L")}t.exceptions=[];for(var s=0,r=this.exceptions.length;s<r;s++){t.exceptions.push(this.exceptions[s].format("L"))}t.rules=this.rules;return t};l.prototype.repeats=function(){if(this.rules.length>0){return true}return false};l.prototype.every=function(r,s){if((typeof r!=="undefined")&&(r!==null)){this.units=m(r)}if((typeof s!=="undefined")&&(s!==null)){this.measure=q(s)}return h.call(this)};l.prototype.except=function(r){r=c(r).dateOnly();this.exceptions.push(r);return this};l.prototype.forget=function(s){var t,r;var u=c(s);if(u.isValid()){for(t=0,r=this.exceptions.length;t<r;t++){if(u.isSame(this.exceptions[t])){this.exceptions.splice(t,1);return this}}return this}for(t=0,r=this.rules.length;t<r;t++){if(this.rules[t].measure===q(s)){this.rules.splice(t,1)}}};l.prototype.matches=function(t,r){var s=c(t).dateOnly();if(!s.isValid()){throw Error("Invalid date supplied to match method: "+t)}if(!r&&!o(this.start,this.end,s)){return false}if(j(this.exceptions,s)){return false}if(!i(this.rules,s,this.start)){return false}return true};l.prototype.next=function(r,s){return n.call(this,r,s,"next")};l.prototype.previous=function(r,s){return n.call(this,r,s,"previous")};for(var f in g){if(k.hasOwnProperty(f)){l.prototype[f]=l.prototype[g[f]]=p(f)}}return l}());c.recur=function(g,f){if(g===Object(g)){return new a(g)}return new a({start:g,end:f})};c.fn.recur=function(g,f){if(g===Object(g)){if(typeof g.start==="undefined"){g.start=this}return new a(g)}if(!f){f=g;g=undefined}if(!g){g=this}return new a({start:g,end:f,moment:this})};c.fn.monthWeek=function(){var g=this.clone().startOf("month").startOf("week");var f=this.clone().startOf("week");return f.diff(g,"weeks")};c.fn.dateOnly=function(){return this.hours(0).minutes(0).seconds(0).milliseconds(0)};return c}));