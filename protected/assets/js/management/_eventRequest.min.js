(function(a,b,c){a.endpoints={updateRecord:"/server/endpoint",addReservation:"/server/endpoint",acknowledgeRecord:"/server/endpoint",acceptRecord:"/server/endpoint",rejectRecord:"/server/endpoint",deleteRecord:"/server/endpoint"};a.data={};a.attribute={name:"",oldVal:"",newVal:""};a.userId=0;a.userName="";a.onReady=function(){if(typeof b.fn.editable==="undefined"){a.loadEditable()}else{a.enableEditable()}var d=b("#eventRequestView.panel.panel-primary");if(d.length>0){d.on("destroyed",function(){var e=b("#eventRequestView.panel.panel-primary .editable");e.editable("destroy")})}};a.loadEditable=function(){b.ajax({url:utilities.urls.assets+(utilities.debug?"/bootstrap-editable/js/bootstrap-editable.js":"/bootstrap-editable/js/bootstrap-editable.min.js"),dataType:"script",cache:true,success:function(){window.setTimeout(function(){a.enableEditable()},1000)},error:function(f,d,e){utilities.ajaxError.show("Error","Failed to retrieve javsScript file",f,d,e)}})};a.enableEditable=function(){a.setupRequesterPhone();a.setupNotes();a.setupMessageButton();a.setupDeleteButton();if(a.data.parms.acknowledged==false){a.setupAcknowledgeButton()}if(a.data.parms.accepted==false&&a.data.parms.rejected==false){a.setupRejectButton();a.setupAcceptButton()}else{if(a.data.parms.accepted==true&&a.data.parms.rejected==false){a.setupReservationButton()}}a.makeButtonsEqualHeight()};a.makeButtonsEqualHeight=function(){var f=0;var e=0;var d=b("#eventRequestView.panel.panel-primary button.btn-block");d.each(function(){var g=b(this);f=Math.max(g.height(),f);e=Math.max(g.width(),e)});d.height(f)};a.setupNotes=function(){b("#notes").editable({emptytext:"Add Note",params:a.data.parms,showbuttons:"bottom",success:function(d,e){if(d&&d.length>0){return"Data not saved. Please refresh the page as it appears the session has expired."}b(this).data("editable").hide();b("#notesHistory").text(b("#notesHistory").text()+e);b(this).data("editable").input.$input.val("");e="";return"Note added"},validate:function(e){if(b.trim(e)==""){return"This field is required"}var d="";d+=moment().format("MM/DD/YYYY h:mm:ss A")+" by "+a.userName+":\r\n\r\n";d+=e+"\r\n\r\n";return{newValue:d}}})};a.setupRequesterPhone=function(){b("#requester_phone").editable({params:a.data.parms,display:function(f,e){var d="";if(typeof f==="undefined"||f.length<=0){return}d=f.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3");b(this).html(d)}});b("#requester_phone").on("shown",function(f,d){if(d){b(this).data("editable").input.$input.inputmask({mask:a.data.item.fields.requester_phone.inputmask.mask,clearIncomplete:false,autoUnmask:true})}})};a.setupRejectButton=function(){b("#rejector_id").on("click",function(f){f.preventDefault();f.stopPropagation();var d=b(".rejected_reason");d.show();b(".rejected_reason").editable({showbuttons:"bottom",placement:"top",validate:function(e){if(b.trim(e)==""){return"This field is required"}}});d.editable("show")});b(".rejected_reason").on("hidden",function(g,f){if(arguments.length!=2){return}var d=b(".rejected_reason");d.hide()});b(".rejected_reason").on("save",function(h,j){var d=b(".rejected_reason");d.hide();var f=b("#eventRequestView.panel.panel-primary button.btn-block");f.prop("disabled",true);var i='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';b("#deleteRequest").attr("disabled","disabled");b("#deleteRequest").parent().prepend(i);var g={action:"reject",pk:a.data.pk.value,requester_name:a.data.item.fields.requester_name.value,requester_email:a.data.item.fields.requester_email.value,rejected_reason:j.newValue,id:a.data.item.fields.id.value,eid:a.data.parms.eid,aid:a.data.parms.aid,lid:a.data.parms.lid,rejected:a.data.parms.rejected,accepted:a.data.parms.accepted,acknowledged:a.data.parms.acknowledged};j.newValue="";b(".rejected_reason").editable("destroy");b("#rejector_id").toggleClass("active");b.ajax({url:a.endpoints.updateRecord,type:"POST",dataType:"html",data:g,success:function(e,k,m){var n=false;try{n=JSON.parse(e)}catch(l){n=false}if(n!==false){window.setTimeout(function(){b("#rejector_id").toggleClass("active");f.prop("disabled",false);utilities.ajaxError.show("Event Request","Failed to reject request",m,"error","Login Required")},1000);return}a.data.parms.rejected=true;a.data.parms.acknowledged=true;f.prop("disabled",false);b("#deleteRequest").prop("disabled",false);b("#deleteRequest").parent().find("#loading").remove();b("#rejector_id").toggleClass("active");b(".alert").remove();b("#acknowledger_id").off("click");b("#acknowledger_id").parent().remove();b("#accepter_id").off("click");b("#accepter_id").parent().remove();b(".rejected_reason").off("save");b(".rejected_reason").off("hidden");b("#rejector_id").off("click");b("#rejector_id").parent().remove();utilities.addAlert("alerts","alert alert-success","Request successfully rejected!","The request has been rejected.<br />The requester has been notified via e-mail that their request has been rejected for the reason you provided.<br />You may use the Message button to contact the requester if you need to.")},error:function(l,e,k){f.prop("disabled",false);b("#deleteRequest").prop("disabled",false);b("#deleteRequest").parent().find("#loading").remove();b("#rejector_id").toggleClass("active");utilities.ajaxError.show("Error","Reject Request",l,e,k)}})})};a.setupAcknowledgeButton=function(){b("#acknowledger_id").on("click",function(g){g.preventDefault();g.stopPropagation();var f={action:"acknowledge",pk:a.data.pk.value,requester_name:a.data.item.fields.requester_name.value,requester_email:a.data.item.fields.requester_email.value,id:a.data.item.fields.id.value,eid:a.data.parms.eid,aid:a.data.parms.aid,lid:a.data.parms.lid,rejected:a.data.parms.rejected,accepted:a.data.parms.accepted,acknowledged:a.data.parms.acknowledged};var d=b("#eventRequestView.panel.panel-primary button.btn-block");d.prop("disabled",true);var h='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';b("#deleteRequest").attr("disabled","disabled");b("#deleteRequest").parent().prepend(h);b("#acknowledger_id").toggleClass("active");b.ajax({url:a.endpoints.updateRecord,type:"POST",dataType:"html",data:f,success:function(e,i,k){var l=false;try{l=JSON.parse(e)}catch(j){l=false}if(l!==false){window.setTimeout(function(){b("#acknowledger_id").toggleClass("active");d.prop("disabled",false);utilities.ajaxError.show("Event Request","Failed to acknowledge request",k,"error","Login Required")},1000);return}a.data.parms.acknowledged=true;d.prop("disabled",false);b("#deleteRequest").parent().find("#loading").remove();b("#acknowledger_id").toggleClass("active");b(".alert.alert-danger").remove();b("#acknowledger_id").off("click");b("#acknowledger_id").parent().remove();utilities.addAlert("alerts","alert alert-success","Request successfully acknowledged!","The request has been acknowledged.<br />The requester has been notified via e-mail that their request has been acknowledged.<br />You may use the Message button to contact the requester if you need to.<br /><strong>Please remember that the request still needs to be either accepted or rejected.</strong>")},error:function(j,e,i){d.prop("disabled",false);b("#deleteRequest").parent().find("#loading").remove();b("#acknowledger_id").toggleClass("active");utilities.ajaxError.show("Error","Acknowledge Request",j,e,i)}})})};a.setupAcceptButton=function(){b("#accepter_id").on("click",function(g){g.preventDefault();g.stopPropagation();var f={action:"accept",pk:a.data.pk.value,requester_name:a.data.item.fields.requester_name.value,requester_email:a.data.item.fields.requester_email.value,id:a.data.item.fields.id.value,eid:a.data.parms.eid,aid:a.data.parms.aid,lid:a.data.parms.lid,rejected:a.data.parms.rejected,accepted:a.data.parms.accepted,acknowledged:a.data.parms.acknowledged};var d=b("#eventRequestView.panel.panel-primary button.btn-block");d.prop("disabled",true);var h='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';b("#deleteRequest").attr("disabled","disabled");b("#deleteRequest").parent().prepend(h);b("#accepter_id").toggleClass("active");b.ajax({url:a.endpoints.updateRecord,type:"POST",dataType:"html",data:f,success:function(e,i,l){var m=false;try{m=JSON.parse(e)}catch(j){m=false}if(m!==false){window.setTimeout(function(){b("#accepter_id").toggleClass("active");d.prop("disabled",false);utilities.ajaxError.show("Event Request","Failed to accept the request",l,"error","Login Required")},1000);return}a.data.parms.acknowledged=true;a.data.parms.accepted=true;var k=b("#accepter_id").parent();b("#deleteRequest").parent().find("#loading").remove();d.prop("disabled",false);b("#accepter_id").toggleClass("active");b(".alert").remove();b("#acknowledger_id").off("click");b("#acknowledger_id").parent().remove();b("#accepter_id").off("click");b("#accepter_id").parent().remove();b(".rejected_reason").off("save");b(".rejected_reason").off("hidden");b(".rejected_reason").remove();b("#rejector_id").off("click");b("#rejector_id").parent().remove();a.addReservationButton(k);utilities.addAlert("alerts","alert alert-success","Request successfully accepted!","The request has been accepted.<br />The requester has been notified via e-mail that their request has been accepted.<br />Please be sure to respond to any other pending requests.<br />To remove this event from the search results, you may update the event status to closed.<br />You may use the Message button to contact the requester if you need to.<br />")},error:function(j,e,i){d.prop("disabled",false);b("#deleteRequest").parent().find("#loading").remove();b("#accepter_id").toggleClass("active");utilities.ajaxError.show("Error","Accept Request",j,e,i)}})})};a.setupMessageButton=function(){b("#message").on("click",function(h){h.preventDefault();h.stopPropagation();var d=b(".message_box");d.show();var g=b(window).width();var f="right";if(g<767){f="top"}b(".message_box").editable({showbuttons:"bottom",placement:f});d.editable("show")});b(".message_box").on("hidden",function(g,f){if(arguments.length!=2){return}var d=b(".message_box");d.hide()});b(".message_box").on("save",function(h,j){var d=b(".message_box");d.hide();var f=b("#eventRequestView.panel.panel-primary button.btn-block");f.prop("disabled",true);var i='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';b("#deleteRequest").attr("disabled","disabled");b("#deleteRequest").parent().prepend(i);var g={action:"message",pk:a.data.pk.value,requester_name:a.data.item.fields.requester_name.value,requester_email:a.data.item.fields.requester_email.value,message:j.newValue,id:a.data.item.fields.id.value,eid:a.data.parms.eid,aid:a.data.parms.aid,lid:a.data.parms.lid,rejected:a.data.parms.rejected,accepted:a.data.parms.accepted,acknowledged:a.data.parms.acknowledged};j.newValue="";b(".message_box").editable("destroy");b("#message").toggleClass("active");b.ajax({url:a.endpoints.updateRecord,type:"POST",dataType:"html",data:g,success:function(e,k,m){var n=false;try{n=JSON.parse(e)}catch(l){n=false}if(n!==false){window.setTimeout(function(){b("#message").toggleClass("active");f.prop("disabled",false);utilities.ajaxError.show("Event Request","Failed to send message",m,"error","Login Required")},1000);return}f.prop("disabled",false);b("#deleteRequest").prop("disabled",false);b("#deleteRequest").parent().find("#loading").remove();b("#message").toggleClass("active");utilities.addAlert("alerts","alert alert-success","Messsage successfully sent!","The message has been sent as you requested.")},error:function(l,e,k){f.prop("disabled",false);b("#deleteRequest").prop("disabled",false);b("#deleteRequest").parent().find("#loading").remove();b("#message").toggleClass("active");utilities.ajaxError.show("Error","Send Message",l,e,k)}})})};a.addReservationButton=function(e){return;var d='<button class="btn btn-block btn-large btn-success" type="button" data-toggle="tooltip" data-original-title="Create a reservation for this request" id="createReservation"><i class="fa fa-lg fa-plus-square"></i> <br /><span>Reservation</span></button>';e.append(d);a.makeButtonsEqualHeight();a.setupReservationButton()};a.setupReservationButton=function(){b("#createReservation").on("click",function(i){i.preventDefault();i.stopPropagation();window.alert("This feature is coming in a future relase.");return;var g={action:"create",output:"html",fid:a.data.item.fields.requester_id.value,fname:a.data.item.fields.requester_name.value,femail:a.data.item.fields.requester_email.value,fphone:a.data.item.fields.requester_phone.value,erid:a.data.item.fields.id.value,eid:a.data.parms.eid,aid:a.data.parms.aid,lid:a.data.parms.lid,};var d=utilities.modal.add("Create Reservation","",false,false,true);d.modal({loading:true,replace:false,modalOverflow:true});var f=this;var h=d;b.ajax({url:a.endpoints.addReservation,type:"POST",dataType:"html",data:g,success:function(e,j,l){var m=false;try{m=JSON.parse(e)}catch(k){m=false}if(m!==false){window.setTimeout(function(){h.modal("loading");h.find(".modal-body").empty().append('<h1 class="text-error">Error</h1>');utilities.ajaxError.show("Create Reservation","Failed to retrieve data",l,"error","Login Required")},1000);return}window.setTimeout(function(){h.find(".modal-body").empty().append(e);h.modal("loading")},1000)},error:function(k,e,j){window.setTimeout(function(){h.modal("loading");h.find(".modal-body").empty().append('<h1 class="text-error">Error</h1>');utilities.ajaxError.show("Create Reservation","Failed to retrieve data",k,e,j)},1000)}})})};a.setupDeleteButton=function(){b("#deleteRequest").on("click",function(g){g.preventDefault();g.stopPropagation();var f={output:"html",id:a.data.item.fields.id.value,pk:a.data.item.fields.id.value,eid:a.data.parms.eid,aid:a.data.parms.aid};var d=a.createDeleteModal();d.modal({loading:false,replace:false,modalOverflow:false});b("button#yes").on("click",function(i){var h=b("#eventRequestView.panel.panel-primary button.btn-block");h.prop("disabled",true);var j='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';b("#deleteRequest").attr("disabled","disabled");b("#deleteRequest").parent().prepend(j);b.ajax({url:a.endpoints.deleteRecord,type:"POST",dataType:"html",data:f,success:function(e,k,o){var p=false;try{p=JSON.parse(e)}catch(m){p=false}if(p!==false){window.setTimeout(function(){h.prop("disabled",false);utilities.ajaxError.show("Delete Event Request","Failed to retrieve data",o,"error","Login Required")},1000);return}var n=b("#eventRequestView").find(".panel-body");var l=b('<h1 class="text-success">The request has been deleted!</h1>');l.hide();n.fadeOut(250,function(){n.empty();n.append(l);n.fadeIn(250,function(){l.fadeIn(250)})})},error:function(l,e,k){h.prop("disabled",false);b("#deleteRequest").parent().find("#loading").remove();window.setTimeout(function(){utilities.ajaxError.show("Delete Event Request","Failed to retrieve data",l,e,k)},1000)}})})})};a.createDeleteModal=function(){var e='<div id="deleteModal" class="well"><h3>Are you sure you want to permanently delete this item?</h3><p class="lead text-error">This operation cannot be undone and will also delete this item from any related items. For example, deleting a location / venue will also delete any events associated with that location / venue.</p></div>';var d='<button class="btn btn-large btn-danger" data-dismiss="modal" type="button" aria-hidden="true" id="yes"><i class="fa fa-fw fa-lg fa-check"></i> Yes</button><button class="btn btn-large" data-dismiss="modal" type="button" aria-hidden="true" id="close"><i class="fa fa-fw fa-lg fa-times"></i> No</button>';return utilities.modal.add("Confirm Action",e,d,false,false)}}(window._eventRequest=window._eventRequest||{},jQuery));