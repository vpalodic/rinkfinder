(function(b,a,c){b.endpoints={location:{viewRecord:"/server/endpoint",updateRecord:"/server/endpoint",newRecord:"/server/endpoint",deleteRecord:"/server/endpoint"}};b.location={};b.locationTypes=[];b.locationStatuses=[];b.params={};b.isArenaManager=false;b.Id=0;b.Name="";b.onReady=function(){if(typeof a.fn.editable==="undefined"){b.loadEditable()}else{b.setupInitialLocationView()}var d=a("#locationManagementView.panel.panel-primary");if(d.length>0){d.on("destroyed",function(){var e=a("#locationManagementView.panel.panel-primary .editable");e.editable("destroy")})}a('[data-toggle="tooltip"]').tooltip()};b.loadEditable=function(){var e=utilities.debug?"bootstrap-editable.js":"bootstrap-editable.min.js";a.ajax({url:utilities.urls.assets+(utilities.debug?"/bootstrap-editable/js/bootstrap-editable.js":"/bootstrap-editable/js/bootstrap-editable.min.js"),dataType:"script",cache:true,success:function(){console.log("Loaded: "+e)},error:function(h,f,g){utilities.ajaxError.show("Error","Failed to retrieve javsScript file",h,f,g)}});var d=setInterval(function(){if(typeof typeof a.fn.editable!=="undefined"){clearInterval(d);b.setupInitialLocationView()}else{if(console&&console.log){console.log("Loading... "+e)}}},500)};b.createDeleteModal=function(){var e='<div id="deleteModal" class="well"><h3>Are you sure you want to permanently delete this item?</h3><p class="lead text-error">This operation cannot be undone and will also delete this item from any related items. For example, deleting a location / venue will also delete any events associated with that location / venue.</p></div>';var d='<button class="btn btn-large btn-danger" data-dismiss="modal" type="button" aria-hidden="true" id="yes"><i class="fa fa-fw fa-lg fa-check"></i> Yes</button><button class="btn btn-large" data-dismiss="modal" type="button" aria-hidden="true" id="close"><i class="fa fa-fw fa-lg fa-times"></i> No</button>';return utilities.modal.add("Confirm Action",e,d,false,false)};b.setupInitialLocationView=function(){var h=this;var d=a("#newLocationButton");var f=a("#deleteLocationButton");var g=a("#saveLocationButton");var e=a("#cancelLocationButton");var i=a("#locationsSelect");f.attr("disabled","disabled");g.attr("disabled","disabled").hide();e.attr("disabled","disabled").hide();i.on("change",function(l){var j=i.find("option:selected");if(j.length>0){var k=a(this).val();h.resetLocationView();if(k=="none"){return}h.loadLocation(k)}else{h.resetLocationView()}});d.on("click",function(k){k.preventDefault();i.attr("disabled","disabled");i.val("none");var j={aid:b.params.aid,output:"html"};b.setupNewLocationView(j);d.attr("disabled","disabled");f.attr("disabled","disabled")});f.on("click",function(k){k.preventDefault();var j=b.createDeleteModal();j.modal({loading:false,replace:false,modalOverflow:false});a("button#yes").on("click",function(n){var m=i.val();var o='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';i.attr("disabled","disabled");d.attr("disabled","disabled");f.attr("disabled","disabled");g.attr("disabled","disabled").hide();e.attr("disabled","disabled").hide();f.parent().prepend(o);var l={aid:b.params.id,id:m,pk:m,output:"html"};a.ajax({url:b.endpoints.location.deleteRecord,data:l,type:"POST",dataType:"html",success:function(p,q,s){var t=false;try{t=JSON.parse(p)}catch(r){t=false}if(t!==false){window.setTimeout(function(){i.removeAttr("disabled");d.removeAttr("disabled");f.removeAttr("disabled");utilities.ajaxError.show("Error","Failed to delete the venue",s,"error","Login Required")},1000);return}i.find('option[value="'+m+'"]').remove();i.val("none").trigger("change");i.removeAttr("disabled");d.removeAttr("disabled");f.parent().find("#loading").remove()},error:function(r,p,q){i.removeAttr("disabled");d.removeAttr("disabled");f.parent().find("#loading").remove();utilities.ajaxError.show("Error","Failed to delete the venue",r,p,q)}})})});g.on("click",function(j){j.preventDefault();var k='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';i.attr("disabled","disabled");d.attr("disabled","disabled");f.attr("disabled","disabled");g.attr("disabled","disabled");e.attr("disabled","disabled");g.parent().prepend(k);a(".location-editable").editable("submit",{url:b.endpoints.location.newRecord,ajaxOptions:{dataType:"json"},success:function(s,n){g.removeAttr("disabled");e.removeAttr("disabled");g.parent().find("#loading").remove();if(s&&s.id){a(this).editable("option","pk",s.id);a("#Location_tags").editable("setValue",s.tags);a(this).removeClass("editable-unsaved");var r=a("#Location_name").editable("getValue");var l=a("#Location_status_id").text();var q=a("#Location_type_id").text();var p=r.name+" - "+q+" ("+l+")";var o='<option value="'+s.id+'">'+p+"</option>";i.append(o);i.val(s.id);g.attr("disabled","disabled").hide(250);e.attr("disabled","disabled").hide(250);i.removeAttr("disabled");d.removeAttr("disabled");f.removeAttr("disabled");var m='<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button><h3><span class="badge badge-success">New location added!</span></h3></div>';a("#locationDetails").prepend(m)}else{if(s&&s.errors){n.error.call(this,s.errors)}else{if(s&&s.error){n.error.call(this,s.error)}}}},error:function(o){g.removeAttr("disabled");e.removeAttr("disabled");g.parent().find("#loading").remove();var n="";if(o&&o.responseText){n=o.responseText;utilities.ajaxError.show("Error","Failed to add the new location",o,"error","Unknown")}else{try{if(o){o=JSON.parse(o)}a.each(o,function(q,p){n+=p+"<br>"})}catch(m){o=false}}var l='<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button><h3><span class="badge badge-important">Please correct the following errors:</span></h3>'+n+"</div>";a("#locationDetails").prepend(l)}})});e.on("click",function(j){j.preventDefault();b.resetLocationView()});if(b.location.id!=="undefined"){b.setupLocationView(b.location,b.params)}};b.setupLocationEditables=function(d){a("#Location_name").editable({params:d,success:function(f,j){if(f&&f.length>0){return"Data not saved. Please refresh the page as it appears the session has expired."}var e=a("#Location_status_id").text();var i=a("#Location_type_id").text();var h=j+" - "+i+" ("+e+")";var g=a("#locationsSelect");var k=g.val();if(k=="none"){return}g.find('option[value="'+k+'"]').text(h)}});a("#Location_external_id").editable({params:d});a("#Location_status_id").editable({params:d,showbuttons:false,source:b.locationStatuses,success:function(f,k){if(f&&f.length>0){return"Data not saved. Please refresh the page as it appears the session has expired."}var j=a("#Location_name").editable("getValue");var e=a("#Location_status_id").text();var i=a("#Location_type_id").text();var h=j.name+" - "+i+" ("+e+")";var g=a("#locationsSelect");var l=g.val();if(l=="none"){return}g.find('option[value="'+l+'"]').text(h)}});a("#Location_type_id").editable({params:d,showbuttons:false,source:b.locationTypes,success:function(f,k){if(f&&f.length>0){return"Data not saved. Please refresh the page as it appears the session has expired."}var j=a("#Location_name").editable("getValue");var e=a("#Location_status_id").text();var i=a("#Location_type_id").text();var h=j.name+" - "+i+" ("+e+")";var g=a("#locationsSelect");var l=g.val();if(l=="none"){return}g.find('option[value="'+l+'"]').text(h)}});a("#Location_notes").editable({params:d,toggle:"manual"});a("#Location_notes_edit").off("click");a("#Location_notes_edit").on("click",function(f){f.stopPropagation();f.preventDefault();a("#Location_notes").editable("toggle")});a("#Location_description").editable({params:d,toggle:"manual"});a("#Location_description_edit").off("click");a("#Location_description_edit").on("click",function(f){f.stopPropagation();f.preventDefault();a("#Location_description").editable("toggle")});a("#Location_tags").editable({params:d});a("#Location_length").editable({params:d});a("#Location_width").editable({params:d});a("#Location_radius").editable({params:d});a("#Location_seating").editable({params:d})};b.setupLocationView=function(e,i){var g=a("#locationDetails");var h=a(".location-editable");a("#Location_notes_edit").off("click");a("#Location_description_edit").off("click");if(h.length>0){h.each(function(){a(this).editable("destroy")})}var f='<strong>Details</strong><br /><table class="table table-condensed table-information"><tbody>';f+='<tr><td style="width:33%">Name</td><td><a href="#" id="Location_name" data-name="name" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+e.name+'" title="Venue Name" class="location-editable">'+e.name+"</a></td></tr>";f+='<tr><td style="width:33%">External ID</td><td><a href="#" id="Location_external_id" data-name="external_id" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+(e.external_id?e.external_id:"")+'" title="Your Venue ID" class="location-editable">'+(e.external_id?e.external_id:"")+"</a></td></tr>";f+='<tr><td style="width:33%">Tags</td><td><a href="#" id="Location_tags" data-name="tags" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+e.tags+'" title="Venue Tags" class="location-editable">'+e.tags+"</a></td></tr>";f+='<tr><td style="width:33%">Type</td><td><a href="#" id="Location_type_id" data-name="type_id" data-type="select" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+e.type_id+'" title="Venue Type" class="location-editable">'+e.type+"</a></td></tr>";f+='<tr><td style="width:33%">Status</td><td><a href="#" id="Location_status_id" data-name="status_id" data-type="select" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+e.status_id+'" title="Venue Status" class="location-editable">'+e.status+"</a></td></tr>";f+="</tbody></table>";f+='<strong>Additional Details</strong><br /><table class="table table-condensed table-information"><tbody>';f+='<tr><td style="width:33%">Length (ft)</td><td><a href="#" id="Location_length" data-name="length" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+(e.length?e.length:"")+'" title="Venue length in feet" class="location-editable">'+(e.length?e.length:"")+"</a></td></tr>";f+='<tr><td style="width:33%">Width (ft)</td><td><a href="#" id="Location_width" data-name="width" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+(e.width?e.width:"")+'" title="Venue width in feet" class="location-editable">'+(e.width?e.width:"")+"</a></td></tr>";f+='<tr><td style="width:33%">Radius (ft)</td><td><a href="#" id="Location_radius" data-name="radius" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+(e.radius?e.radius:"")+'" title="Venue readius in feet" class="location-editable">'+(e.radius?e.radius:"")+"</a></td></tr>";f+='<tr><td style="width:33%">Seating Capacity</td><td><a href="#" id="Location_seating" data-name="seating" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+(e.seating?e.seating:"")+'" title="Venue seating capacity" class="location-editable">'+(e.seating?e.seating:"")+"</a></td></tr>";f+="</tbody></table>";f+='<strong>Description & Notes</strong><br /><table class="table table-condensed table-information"><tbody>';f+='<tr><td style="width:33%">Description<i class="fa fa-lg fa-fw fa-pencil" style="padding-right: 5px"></i> <a href="#" id="Location_description_edit"><span>[edit]</span></a></td><td><div id="Location_description" data-name="description" data-type="wysihtml5" data-mode="inline" data-toggle="manual" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+(e.description?e.description:"")+'" title="Venue Description" class="location-editable">'+(e.description?e.description:"")+"</div></td></tr>";f+='<tr><td style="width:33%">Notes<i class="fa fa-lg fa-fw fa-pencil" style="padding-right: 5px"></i> <a href="#" id="Location_notes_edit"><span>[edit]</span></a></td><td><div id="Location_notes" data-name="notes" data-type="wysihtml5" data-mode="inline" data-toggle="manual" data-url="'+b.endpoints.location.updateRecord+'" data-pk="'+e.id+'" data-value="'+(e.notes?e.notes:"")+'" title="Venue Notes" class="location-editable">'+(e.notes?e.notes:"")+"</div></td></tr>";f+="</tbody></table>";var d=a('<div id="locationDetails">'+f+"</div>");d.hide();g.fadeOut(500,function(){g.parent().prepend(d);b.setupLocationEditables(i);d.fadeIn(500,function(){var j=a("#newLocationButton");var k=a("#deleteLocationButton");var l=a("#locationsSelect");l.removeAttr("disabled");j.removeAttr("disabled");k.removeAttr("disabled");l.parent().find("#loading").remove();g.remove()})})};b.setupNewLocationView=function(h){var f=a("#locationDetails");var g=a(".location-editable");a("#Location_notes_edit").off("click");a("#Location_description_edit").off("click");if(g.length>0){g.each(function(){a(this).editable("destroy")})}var e='<strong>Details</strong><br /><table class="table table-condensed table-information"><tbody>';e+='<tr><td style="width:33%">Name</td><td><a href="#" id="Location_name" data-name="name" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Venue Name" class="location-editable"></a></td></tr>';e+='<tr><td style="width:33%">External ID</td><td><a href="#" id="Location_external_id" data-name="external_id" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Your Venue ID" class="location-editable"></a></td></tr>';e+='<tr><td style="width:33%">Tags</td><td><a href="#" id="Location_tags" data-name="tags" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Venue Tags" class="location-editable"></a></td></tr>';e+='<tr><td style="width:33%">Type</td><td><a href="#" id="Location_type_id" data-name="type_id" data-type="select" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-value="1" title="Venue Type" class="location-editable"></a></td></tr>';e+='<tr><td style="width:33%">Status</td><td><a href="#" id="Location_status_id" data-name="status_id" data-type="select" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-value="1" title="Venue Status" class="location-editable"></a></td></tr>';e+="</tbody></table>";e+='<strong>Email & Phone</strong><br /><table class="table table-condensed table-information"><tbody>';e+='<tr><td style="width:33%">Length (ft)</td><td><a href="#" id="Location_length" data-name="length" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Venue length in feet" class="location-editable"></a></td></tr>';e+='<tr><td style="width:33%">Width (ft)</td><td><a href="#" id="Location_width" data-name="width" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Venue width in feet" class="location-editable"></a></td></tr>';e+='<tr><td style="width:33%">Radius (ft)</td><td><a href="#" id="Location_radius" data-name="radius" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Venue readius in feet" class="location-editable"></a></td></tr>';e+='<tr><td style="width:33%">Seating Capacity</td><td><a href="#" id="Location_seating" data-name="seating" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Venue seating capacity" class="location-editable"></a></td></tr>';e+='<tr style="display:none;"><td>Arena ID</td><td><a href="#" id="Location_arena_id" data-name="aid" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-value="'+b.params.aid+'" title="Arena ID" class="location-editable">'+b.params.aid+"</a></td></tr>";e+='<tr style="display:none;"><td>Output</td><td><a href="#" id="Location_output" data-name="output" data-type="text" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" data-value="json" title="Output" class="location-editable">json</a></td></tr>';e+="</tbody></table>";e+='<strong>Description & Notes</strong><br /><table class="table table-condensed table-information"><tbody>';e+='<tr><td style="width:33%">Description<i class="fa fa-lg fa-fw fa-pencil" style="padding-right: 5px"></i> <a href="#" id="Location_description_edit"><span>[edit]</span></a></td><td><div id="Location_description" data-name="description" data-type="wysihtml5" data-toggle="manual" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Venue Description" class="location-editable"></div></td></tr>';e+='<tr><td style="width:33%">Notes<i class="fa fa-lg fa-fw fa-pencil" style="padding-right: 5px"></i> <a href="#" id="Location_notes_edit"><span>[edit]</span></a></td><td><div id="Location_notes" data-name="notes" data-type="wysihtml5" data-toggle="manual" data-mode="inline" data-url="'+b.endpoints.location.updateRecord+'" title="Venue Notes" class="location-editable"></div></td></tr>';e+="</tbody></table>";var d=a('<div id="locationDetails">'+e+"</div>");d.hide();f.fadeOut(500,function(){f.parent().prepend(d);b.setupLocationEditables(h);a("#Location_arena_id").editable({params:h});a("#Location_output").editable({params:h});d.fadeIn(500,function(){var j=a("#saveLocationButton");var i=a("#cancelLocationButton");j.removeAttr("disabled").show(250);i.removeAttr("disabled").show(250);f.remove()})})};b.resetLocationView=function(){var g=a("#locationDetails");var j=a(".location-editable");var d=a("#newLocationButton");var f=a("#deleteLocationButton");var h=a("#saveLocationButton");var e=a("#cancelLocationButton");var i=a("#locationsSelect");d.attr("disabled","disabled");f.attr("disabled","disabled");h.attr("disabled","disabled").hide();e.attr("disabled","disabled").hide();a("#Location_notes_edit").off("click");a("#Location_description_edit").off("click");if(j.length>0){j.each(function(){a(this).editable("destroy")})}g.fadeOut(500,function(){g.empty();g.fadeIn(500,function(){d.removeAttr("disabled");i.removeAttr("disabled")})})};b.loadLocation=function(g){var e=a("#newLocationButton");var h=a("#deleteLocationButton");var i=a("#saveLocationButton");var f=a("#cancelLocationButton");var j=a("#locationsSelect");var k='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader.gif" alt="Loading..." /></div>';e.attr("disabled","disabled");h.attr("disabled","disabled");i.attr("disabled","disabled").hide();f.attr("disabled","disabled").hide();j.attr("disabled","disabled");j.parent().append(k);var d={id:g,aid:b.params.aid,output:"json"};a.ajax({url:b.endpoints.location.viewRecord,data:d,type:"GET",dataType:"json",success:function(l,m,n){if(l.error&&l.error==="LOGIN_REQUIRED"){j.removeAttr("disabled");e.removeAttr("disabled");h.removeAttr("disabled");j.parent().find("#loading").remove();window.setTimeout(function(){j.removeAttr("disabled");e.removeAttr("disabled");h.removeAttr("disabled");utilities.ajaxError.show("Error","Failed to load the venue",n,"error","Login Required")},1000);return}d.output="html";if(l.data&&l.data.id!=="undefined"){b.setupLocationView(l.data,d)}},error:function(n,l,m){j.removeAttr("disabled");e.removeAttr("disabled");h.removeAttr("disabled");j.parent().find("#loading").remove();utilities.ajaxError.show("Error","Failed to load the venue",n,l,m)}})}}(window.locationManagementView=window.locationManagementView||{},jQuery));