(function(a,b,c){a.endpoints={uploadFile:"/server/endpoint",deleteFile:"/server/endpoint",processFile:"/server/endpoint"};a.uploadType="";a.userFullName="";a.fileUpload={};a.tableFields=[{}];a.csvFields=[{}];a.csvRows=[{}];a.csvOptions={};a.mappings=[{}];a.loginUrl="";a.baseUrl="";a.arenaId=0;a.arenaName="";a.step=0;a.eventType=0;a.addUploadButton=function(){b('<span>   </span><button id="uploadButton" class="btn btn-success btn-large disabled" name="yt0" type="button"><i class="icon-upload icon-white"></i> Begin Upload</button>').insertAfter(b(".qq-upload-button"))};a.onUploadCancel=function(e,f,d){b("#uploadButton").prop("disabled",true);b("#uploadButton").addClass("disabled");return true};a.onUploadComplete=function(f,h,e,d,g){if(d.success!==true){return false}this.goStep2(d);return true};a.onUploadError=function(h,j,f,d,i){if(j===null||i===null){return false}b("#uploadButton").prop("disabled",true);b("#uploadButton").addClass("disabled");var e="Upload File";var g="<strong>Failed to upload the data file.</strong>";utilities.ajaxError.show(e,g,i,"error",d);b("#loadingScreen").html("");return true};a.onUploadSubmit=function(e,f,d){b("#uploadButton").prop("disabled",false);b("#uploadButton").removeClass("disabled");if(b("#uploadButton").css("display")==="none"){b("#uploadButton").animate({opacity:1},0).fadeIn("fast")}return true};a.onUploadRetry=function(e,f,d){a.setLoadingScreen("#loadingScreen");return true};a.onUploadButtonClick=function(){a.setLoadingScreen("#loadingScreen");b("#uploadButton").prop("disabled",true);b("#uploadButton").addClass("disabled");b("#EventUploadForm_fileName").fineUploader("uploadStoredFiles");return true};a.onDeleteButtonClick=function(d){a.setLoadingScreen("#loadingScreen");b.ajax({url:d.deleteFile.endpoint,type:"DELETE",dataType:"json",data:{fid:d.fileUpload.id,name:d.fileUpload.name},success:function(e,f,g){b("#eventModalLabel").html("Delete Request");b("#eventModalBody").html("<p>File has been deleted, please retry your upload.</p>");b("#eventModal").modal("show");b("#loadingScreen").html("")},error:function(i,e,h){var f="Delete Request";var g="<strong>Failed to delete the file.</strong>";utilities.ajaxError.show(f,g,i,e,h);b("#loadingScreen").html("")}});return true};a.goStep2=function(d){this.step=2;b("#uploadEventsStep1").hide();b("#step2Continue").prop("disabled",false);b("#step2Continue").removeClass("disabled");b("#uploadEventsStep2").show();this.uploadType=d.uploadType;this.userFullName=d.userFullName;this.fileUpload=d.fileUpload;this.arenaId=d.fileUpload.arena_id;this.endpoints.deleteFile=d.deleteFile.endpoint;this.endpoints.processFile=d.processFile.endpoint;b("#loadingScreen").html("")};a.goStep3=function(d){this.step=3;this.csvFields=d.csvFields;this.csvRows=d.csvRows;this.tableFields=d.tableFields;this.setupMappingTable("#mappingTable");b("#step3Previous").prop("disabled",false);b("#step3Previous").removeClass("disabled");b("#uploadEventsStep3").show();b("#loadingScreen").html("")};a.onContinueStep2ButtonClick=function(){this.csvOptions={delimiter:b("#delimiter").val(),enclosure:b("#enclosure").val(),escapeChar:b("#escape-char").val(),skipRows:b("#header-row").val()-1,updateExisting:b("#update-existing").is(":checked")?1:0};this.eventType=b("#eventType").val();var d=this;a.setLoadingScreen("#loadingScreen");b("#step2Continue").prop("disabled",true);b("#step2Continue").addClass("disabled");b("#uploadEventsStep2").hide();b.ajax({url:this.endpoints.processFile,type:"GET",dataType:"json",data:{step:2,fileUpload:{id:this.fileUpload.id,name:this.fileUpload.name,upload_type_id:this.fileUpload.upload_type_id},arenaId:this.fileUpload.arena_id,eventType:this.eventType,csvOptions:this.csvOptions},success:function(e,f,g){d.goStep3(e);return true},error:function(i,e,h){var f="Import Options";var g="<strong>Failed to apply Import Options.</strong>";utilities.ajaxError.show(f,g,i,e,h);b("#step2Continue").prop("disabled",false);b("#step2Continue").removeClass("disabled");b("#uploadEventsStep2").show();b("#loadingScreen").html("")}});return true};a.onPreviousStep3ButtonClick=function(){this.step=2;a.setLoadingScreen("#loadingScreen");b("#step3Continue").prop("disabled",true);b("#step3Continue").addClass("disabled");b("#step3Previous").prop("disabled",true);b("#step3Previous").addClass("disabled");b("#uploadEventsStep3").hide();b("#mappingTable").html("");b("#step2Continue").prop("disabled",false);b("#step2Continue").removeClass("disabled");b("#uploadEventsStep2").show();b("#loadingScreen").html("")};a.onContinueStep3ButtonClick=function(){var d=this;a.setLoadingScreen("#loadingScreen");a.getMappings();b("#step3Continue").prop("disabled",true);b("#step3Continue").addClass("disabled");b("#uploadEventsStep3").hide();b.ajax({url:this.endpoints.processFile+"?step=3",type:"POST",dataType:"json",data:{step:3,fileUpload:{id:this.fileUpload.id,name:this.fileUpload.name,upload_type_id:this.fileUpload.upload_type_id},arenaId:this.fileUpload.arena_id,eventType:this.eventType,csvOptions:this.csvOptions,mappings:this.mappings},success:function(e,f,g){b("#step4Continue").prop("disabled",false);b("#step4Continue").removeClass("disabled");d.showSummary(e.importSummary);b("#uploadEventsStep4").show();b("#loadingScreen").html("")},error:function(i,e,h){var f="Import Data";var g="<strong>Failed to import the the data file.</strong>";utilities.ajaxError.show(f,g,i,e,h);b("#step2Continue").prop("disabled",false);b("#step2Continue").removeClass("disabled");b("#mappingTable").html("");b("#uploadEventsStep2").show();b("#loadingScreen").html("")}});return true};a.onContinueStep4ButtonClick=function(){b("#step4Continue").prop("disabled",true);b("#step4Continue").addClass("disabled");b("#ArenaUploadForm_fileName").fineUploader("clearStoredFiles");b("#mappingTable").html("");b("#uploadEventsStep4").hide();this.clearSummary();b("#uploadEventsStep1").show();return true};a.setLoadingScreen=function(d){var e='<div id="loading"><img src="'+utilities.urls.base+'/images/spinners/ajax-loader-roller-bg_red-fg_blue.gif"alt="Loading..." /><br />Please wait...</div>';b(d).html(e);return e};a.setupMappingTable=function(l){var k=this;var d="<thead><tr><th>Table Column</th><th>Data File Column</th><th data-hide='phone'>Data File Example</th></tr></thead><tbody></tbody><tfoot><tr><td colspan='3'><div class='pagination pagination-centered'></div></td></tr></tfoot>";b(l).append(d);var e=b(l).find("tbody");var n=true;for(var g=0;g<this.tableFields.length;g++){if(n===true){d='<tr class="odd" rel="tooltip" title="'+this.tableFields[g].tooltip+'">';n=false}else{d='<tr class="even" rel="tooltip" title="'+this.tableFields[g].tooltip+'">';n=true}d+='<td id="'+this.tableFields[g].name+'">';d+=this.tableFields[g].name+" ";if(this.tableFields[g].required===true){d+='<span class="required">*</span>'}d+="</td>";d+='<td id="'+this.tableFields[g].name+'SelectField">';d+='<select class="span5" id="'+this.tableFields[g].name+'SelectList" data-index="'+g+'">';d+='<option value="Not Mapped">Not Mapped</option>';var h=false;for(var f=0;f<this.csvFields.length;f++){d+='<option value="'+this.csvFields[f]+'"';if(this.csvFields[f]===this.tableFields[g].name){d+=" selected>";h=true}else{d+=">"}d+=this.csvFields[f]+"</option>"}d+="</select>";d+="</td>";d+='<td id="'+this.tableFields[g].name+'PreviewField">';if(h===true){d+=(this.csvRows[0])[this.tableFields[g].name]}d+="</td>";d+="</tr>";e.append(d);b("#"+this.tableFields[g].name+"SelectList").on("change",function(){if(this.value==="Not Mapped"){b("#"+k.tableFields[b(this).data("index")].name+"PreviewField").html("")}else{b("#"+k.tableFields[b(this).data("index")].name+"PreviewField").html((k.csvRows[0])[this.value])}k.checkStep3Button()})}var m=b("#mappingTable").data("footable");if(typeof m==="object"){m.redraw()}else{b("#mappingTable").footable()}this.checkStep3Button()};a.checkStep3Button=function(){var d=b("#step3Continue").prop("disabled");if(typeof d==="undefined"){d=false}var f=true;for(var e=0;e<this.tableFields.length;e++){if(this.tableFields[e].required===true){if(b("#"+this.tableFields[e].name+"SelectList").val()==="Not Mapped"){f=false}}}if(d===false&&f===false){b("#step3Continue").prop("disabled",true);b("#step3Continue").addClass("disabled")}else{if(d===true&&f===true){b("#step3Continue").prop("disabled",false);b("#step3Continue").removeClass("disabled")}}};a.getMappings=function(){this.mappings=new Array();for(var d=0;d<this.tableFields.length;d++){if(b("#"+this.tableFields[d].name+"SelectList").val()!=="Not Mapped"){this.mappings.push({fieldName:this.tableFields[d].name,headerName:b("#"+this.tableFields[d].name+"SelectList").val(),fieldType:this.tableFields[d].type,fieldSize:this.tableFields[d].size,fieldRequired:this.tableFields[d].required})}}};a.showSummary=function(d){b("#uploadEventsSummaryUpdated").html("<strong>"+d.totalUpdated+"</strong>");b("#uploadEventsSummaryCreated").html("<strong>"+d.totalInserted+"</strong>");b("#uploadEventsSummaryTotal").html("<strong>"+d.totalRecords+"</strong>");if(d.autoTagged){b("#uploadEventsSummaryAutoTagged").addClass("text-success");b("#uploadEventsSummaryAutoTagged").html("<strong>Yes</strong>")}else{b("#uploadEventsSummaryAutoTagged").addClass("text-error");b("#uploadEventsSummaryAutoTagged").html("<strong>No</strong>")}};a.clearSummary=function(){b("#uploadEventsSummaryUpdated").html("");b("#uploadEventsSummaryCreated").html("");b("#uploadEventsSummaryTotal").html("");b("#uploadEventsSummaryAutoTagged").html("");b("#uploadEventsSummaryAutoTagged").removeClass("text-success");b("#uploadEventsSummaryAutoTagged").removeClass("text-error")};a.reset=function(){b("#step4Continue").prop("disabled",true);b("#step4Continue").addClass("disabled");b("#uploadEventsStep4").hide();this.clearSummary();b("#step3Previous").prop("disabled",true);b("#step3Previous").addClass("disabled");b("#step3Continue").prop("disabled",true);b("#step3Continue").addClass("disabled");b("#uploadEventsStep3").hide();b("#mappingTable").html("");b("#step2Continue").prop("disabled",true);b("#step2Continue").addClass("disabled");b("#uploadEventsStep2").hide();b("#EventUploadForm_fileName").fineUploader("clearStoredFiles");b("#uploadButton").prop("disabled",true);b("#uploadButton").addClass("disabled");b("#uploadEventsStep1").show()};a.onResetButtonClick=function(){this.reset();b("#eventModal").modal("hide");return true};a.onReady=function(){if(typeof b.fn.fineUploader==="undefined"){b.ajax({url:utilities.urls.assets+(utilities.debug?"/js/jquery.fineuploader-3.2.js":"/js/jquery.fineuploader-3.2.min.js"),dataType:"script",cache:true,success:function(){window.setTimeout(function(){a.enableFineUploader()},1000)},error:function(f,d,e){utilities.ajaxError.show("Error","Failed to retrieve javsScript file",f,d,e)}})}else{a.enableFineUploader()}if(typeof b.fn.bootstrapSwitch==="undefined"){b.ajax({url:utilities.urls.assets+(utilities.debug?"/js/bootstrap-switch.js":"/js/bootstrap-switch.min.js"),dataType:"script",cache:true,success:function(){},error:function(f,d,e){utilities.ajaxError.show("Error","Failed to retrieve javsScript file",f,d,e)}})}if(typeof b.fn.footable==="undefined"){a.loadFootable()}a.addUploadButton();b("#step2Continue").on("click",function(){return a.onContinueStep2ButtonClick()});b("#step3Previous").on("click",function(){return a.onPreviousStep3ButtonClick()});b("#step3Continue").on("click",function(){return a.onContinueStep3ButtonClick()});b("#step4Continue").on("click",function(){return a.onContinueStep4ButtonClick()});b("#uploadButton").on("click",function(){return a.onUploadButtonClick()});b("#resetButton1").on("click",function(){return a.onResetButtonClick()});b("#resetButton2").on("click",function(){return a.onResetButtonClick()});b("#resetButton3").on("click",function(){return a.onResetButtonClick()});b("#EventUploadForm_fileName").on("complete",function(f,h,e,d,g){return a.onUploadComplete(f,h,e,d,g)});b("#EventUploadForm_fileName").on("submit",function(e,f,d){return a.onUploadSubmit(e,f,d)});b("#EventUploadForm_fileName").on("cancel",function(e,f,d){return a.onUploadCancel(e,f,d)});b("#EventUploadForm_fileName").on("manualRetry",function(e,f,d){return a.onUploadRetry(e,f,d)});b("#EventUploadForm_fileName").on("error",function(f,h,e,d,g){return a.onUploadError(f,h,e,d,g)})};a.loadFootable=function(){b.ajax({url:utilities.urls.assets+(utilities.debug?"/js/footable.js":"/js/footable.min.js"),dataType:"script",cache:true,success:function(){a.loadPaginate()},error:function(f,d,e){utilities.ajaxError.show("Error","Failed to retrieve javsScript file",f,d,e)}})};a.loadPaginate=function(){b.ajax({url:utilities.urls.assets+(utilities.debug?"/js/footable.paginate.js":"/js/footable.paginate.min.js"),dataType:"script",cache:true,success:function(){a.loadSort()},error:function(f,d,e){utilities.ajaxError.show("Error","Failed to retrieve javsScript file",f,d,e)}})};a.loadSort=function(){b.ajax({url:utilities.urls.assets+(utilities.debug?"/js/footable.sort.js":"/js/footable.sort.min.js"),dataType:"script",cache:true,success:function(){a.loadFilter()},error:function(f,d,e){utilities.ajaxError.show("Error","Failed to retrieve javsScript file",f,d,e)}})};a.loadFilter=function(){b.ajax({url:utilities.urls.assets+(utilities.debug?"/js/footable.filter.js":"/js/footable.filter.min.js"),dataType:"script",cache:true,success:function(){},error:function(f,d,e){utilities.ajaxError.show("Error","Failed to retrieve javsScript file",f,d,e)}})};a.enableFineUploader=function(){b("#EventUploadForm_fileName").fineUploader({request:{endpoint:utilities.urls.base+"/event/uploadEventsFile?aid="+a.arenaId,inputName:"EventUploadForm[fileName]"},validation:{allowedExtensions:["csv","tsv","txt"],sizeLimit:null,minSizeLimit:null},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.","emptyError:":"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},debug:false,multiple:false,autoUpload:false,deleteFile:{enabled:true,endpoint:utilities.urls.base+"/event/uploadEventsFileDelete?aid="+a.arenaId},dragAndDrop:{disableDefaultDropzone:true,enable:false},text:{uploadButton:'<i class="icon-file icon-white"></i> Select File'},failedUploadTextDisplay:{mode:"custom",responseProperty:"error"},retry:{showButton:true},template:'<div class="qq-uploader"><div class="qq-upload-button btn btn-warning btn-large"><div>{uploadButtonText}</div></div><span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span><ul class="qq-upload-list"></ul></div>',classes:{button:"qq-upload-button.btn.btn-warning.btn-large",success:"alert alert-success",buttonHover:"",buttonFocus:""}})};a.enableBootstrapSwitches=function(){b(".make-switch")["bootstrapSwitch"]()}}(window.uploadEvents=window.uploadEvents||{},jQuery));