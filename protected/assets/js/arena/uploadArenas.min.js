(function(a,b,c){a.endpoints={uploadFile:"/server/endpoint",deleteFile:"/server/endpoint",processFile:"/server/endpoint"};a.uploadType="";a.userFullName="";a.fileUpload={};a.tableFields=[{}];a.csvFields=[{}];a.csvRows=[{}];a.csvOptions={};a.mappings=[{}];a.loginUrl="";a.baseUrl="";a.step=1;a.addUploadAndDeleteButtons=function(){b('<span>   </span><button id="uploadButton" class="btn btn-success btn-large disabled" name="yt0" type="button"><i class="icon-upload icon-white"></i> Begin Upload</button> <span>   </span><button id="deleteButton" style="display: none;" class="btn btn-danger btn-large disabled" name="yt1" type="button"><i class="icon-trash icon-white"></i> Delete File</button>').insertAfter(b(".qq-upload-button"))};a.onUploadCancel=function(e,f,d){b("#uploadButton").prop("disabled",true);b("#uploadButton").addClass("disabled");if(b("#deleteButton").css("display")!=="none"){b("#deleteButton").animate({opacity:1},0).fadeOut("fast")}return true};a.onUploadComplete=function(f,h,e,d,g){if(d.success!==true){return false}b("#arenaUploadStep1").hide();b("#step2Continue").prop("disabled",false);b("#step2Continue").removeClass("disabled");b("#arenaUploadStep2").show();this.uploadType=d.uploadType;this.userFullName=d.userFullName;this.fileUpload=d.fileUpload;this.endpoints.deleteFile=d.deleteFile.endpoint;this.endpoints.processFile=d.processFile.endpoint;b("#loadingScreen").html("");return true};a.onUploadError=function(h,k,f,d,j){if(k===null||j===null){return false}b("#uploadButton").prop("disabled",true);b("#uploadButton").addClass("disabled");var e=false;try{if(j&&j.responseText){e=JSON.parse(j.responseText)}}catch(g){e=false}b("#arenaModalLabel").html("Upload File");var i='<p class="text-error"><strong>Failed to upload the data file.</strong></p>';i+="<h4>Web Server Response</h4>";i+="<pre>Message: <strong>"+d+"</strong>\n</pre>";if(e!==false&&e.existingFile){if(b("#deleteButton").css("display")==="none"){b("#deleteButton").prop("disabled",false);b("#deleteButton").removeClass("disabled");b("#deleteButton").animate({opacity:1},0).fadeIn("fast");b("#deleteButton").on("click",function(){a.onDeleteButtonClick(e)})}}else{if(e!==false){i+="<h4>Error Details</h4>";if(e.error=="LOGIN_REQUIRED"){i+="<pre>Error: <strong>Session has expired. Please <a href='#' onClick='document.location.reload(true);return false;'><i class='icon-user'></i> login</a> again.</strong>\n"}else{i+="<pre>Error: <strong>"+e.error+"</strong>\n"}if(e.exception==true){i+="Exception Code: <strong>"+e.errorCode+"</strong>\n";i+="Exception File: <strong>"+e.errorFile+"</strong>\n";i+="Exception Line: <strong>"+e.errorLine+"</strong>\n";if(e.errorInfo!=null){i+="</pre><h4>Database Server Response</h4>";i+="<pre>SQLSTATE Code: <strong>"+e.errorInfo.sqlState+"</strong>\n";i+="Driver Code: <strong>"+e.errorInfo.mysqlError+"</strong>\n";i+="Driver Message: <strong>"+e.errorInfo.message+"</strong>\n"}}i+="</pre>";b("#arenaModalBody").html(i);b("#arenaModal").modal("show")}else{if(j&&j.responseText){i+="<h4>Error Details</h4>";i+="<pre>Error: <strong>"+j.responseText+"</strong></pre>";b("#arenaModalBody").html(i);b("#arenaModal").modal("show")}else{b("#arenaModalBody").html(i);b("#arenaModal").modal("show")}}}b("#loadingScreen").html("");return true};a.onUploadSubmit=function(e,f,d){if(b("#uploadButton").length==0){this.addUploadAndDeleteButtons()}b("#uploadButton").prop("disabled",false);b("#uploadButton").removeClass("disabled");if(b("#uploadButton").css("display")==="none"){b("#uploadButton").animate({opacity:1},0).fadeIn("fast")}return true};a.onUploadRetry=function(e,f,d){a.setLoadingScreen("#loadingScreen");return true};a.onUploadButtonClick=function(){a.setLoadingScreen("#loadingScreen");b("#uploadButton").prop("disabled",true);b("#uploadButton").addClass("disabled");if(b("#deleteButton").css("display")!=="none"){b("#deleteButton").animate({opacity:1},100).fadeOut("fast")}b("#ArenaUploadForm_fileName").fineUploader("uploadStoredFiles");return true};a.onDeleteButtonClick=function(d){a.setLoadingScreen("#loadingScreen");b.ajax({url:d.deleteFile.endpoint,type:"DELETE",dataType:"json",data:{fid:d.fileUpload.id,name:d.fileUpload.name},success:function(e,f,g){b("#deleteButton").off("click");b("#deleteButton").prop("disabled",true);b("#deleteButton").addClass("disabled");b("#deleteButton").animate({opacity:1},0).fadeOut("fast");b("#arenaModalLabel").html("Delete Request");b("#arenaModalBody").html("<p>File has been deleted, please retry your upload.</p>");b("#arenaModal").modal("show");b("#loadingScreen").html("")},error:function(j,e,i){var f=false;try{if(j&&j.responseText){f=JSON.parse(j.responseText)}}catch(g){f=false}b("#arenaModalLabel").html("Delete Request");var h='<p class="text-error"><strong>Failed to delete the file.</strong></p>';h+="<h4>Web Server Response</h4>";h+="<pre>Status: <strong>"+e+"</strong>\n";h+="Message: <strong>"+i+"</strong>\n</pre>";if(f!==false){h+="<h4>Error Details</h4>";if(f.error=="LOGIN_REQUIRED"){h+="<pre>Error: <strong>Session has expired. Please <a href='#' onClick='document.location.reload(true);return false;'><i class='icon-user'></i> login</a> again.</strong>\n"}else{h+="<pre>Error: <strong>"+f.error+"</strong>\n"}if(f.exception==true){h+="Exception Code: <strong>"+f.errorCode+"</strong>\n";h+="Exception File: <strong>"+f.errorFile+"</strong>\n";h+="Exception Line: <strong>"+f.errorLine+"</strong>\n";if(f.errorInfo!=null){h+="</pre><h4>Database Server Response</h4>";h+="<pre>SQLSTATE Code: <strong>"+f.errorInfo.sqlState+"</strong>\n";h+="Driver Code: <strong>"+f.errorInfo.mysqlError+"</strong>\n";h+="Driver Message: <strong>"+f.errorInfo.message+"</strong>\n"}}h+="</pre>"}else{if(j&&j.responseText){h+="<h4>Error Details</h4>";h+="<pre>Error: <strong>"+j.responseText+"</strong></pre>"}}b("#arenaModalBody").html(h);b("#arenaModal").modal("show");b("#loadingScreen").html("")}});return true};a.onContinueStep2ButtonClick=function(){this.csvOptions={delimiter:b("#delimiter").val(),enclosure:b("#enclosure").val(),escapeChar:b("#escape-char").val(),skipRows:b("#header-row").val()-1,updateExisting:b("#update-existing").is(":checked")?1:0};var d=this;a.setLoadingScreen("#loadingScreen");b("#step2Continue").prop("disabled",true);b("#step2Continue").addClass("disabled");b("#arenaUploadStep2").hide();b.ajax({url:this.endpoints.processFile,type:"GET",dataType:"json",data:{step:2,fileUpload:{id:this.fileUpload.id,name:this.fileUpload.name,upload_type_id:this.fileUpload.upload_type_id},csvOptions:this.csvOptions},success:function(e,f,g){d.csvFields=e.csvFields;d.csvRows=e.csvRows;d.tableFields=e.tableFields;d.setupMappingTable("#mappingTable");b("#step3Previous").prop("disabled",false);b("#step3Previous").removeClass("disabled");b("#arenaUploadStep3").show();b("#loadingScreen").html("")},error:function(j,e,i){var f=false;try{if(j&&j.responseText){f=JSON.parse(j.responseText)}}catch(g){f=false}b("#arenaModalLabel").html("Import Options");var h='<p class="text-error"><strong>Failed to apply Import Options.</strong></p>';h+="<h4>Web Server Response</h4>";h+="<pre>Status: <strong>"+e+"</strong>\n";h+="Message: <strong>"+i+"</strong>\n</pre>";if(f!==false){h+="<h4>Error Details</h4>";if(f.error=="LOGIN_REQUIRED"){h+="<pre>Error: <strong>Session has expired. Please <a href='#' onClick='document.location.reload(true);return false;'><i class='icon-user'></i> login</a> again.</strong>\n"}else{h+="<pre>Error: <strong>"+f.error+"</strong>\n"}if(f.exception==true){h+="Exception Code: <strong>"+f.errorCode+"</strong>\n";h+="Exception File: <strong>"+f.errorFile+"</strong>\n";h+="Exception Line: <strong>"+f.errorLine+"</strong>\n";if(f.errorInfo!=null){h+="</pre><h4>Database Server Response</h4>";h+="<pre>SQLSTATE Code: <strong>"+f.errorInfo.sqlState+"</strong>\n";h+="Driver Code: <strong>"+f.errorInfo.mysqlError+"</strong>\n";h+="Driver Message: <strong>"+f.errorInfo.message+"</strong>\n"}}h+="</pre>"}else{if(j&&j.responseText){h+="<h4>Error Details</h4>";h+="<pre>Error: <strong>"+j.responseText+"</pre></strong>"}}b("#arenaModalBody").html(h);b("#arenaModal").modal("show");b("#step2Continue").prop("disabled",false);b("#step2Continue").removeClass("disabled");b("#arenaUploadStep2").show();b("#loadingScreen").html("")}});return true};a.onPreviousStep3ButtonClick=function(){var d=this;a.setLoadingScreen("#loadingScreen");b("#step3Continue").prop("disabled",true);b("#step3Continue").addClass("disabled");b("#step3Previous").prop("disabled",true);b("#step3Previous").addClass("disabled");b("#arenaUploadStep3").hide();b("#mappingTable").html("");b("#step2Continue").prop("disabled",false);b("#step2Continue").removeClass("disabled");b("#arenaUploadStep2").show();b("#loadingScreen").html("")};a.onContinueStep3ButtonClick=function(){var d=this;a.setLoadingScreen("#loadingScreen");a.getMappings();b("#step3Continue").prop("disabled",true);b("#step3Continue").addClass("disabled");b("#arenaUploadStep3").hide();b.ajax({url:this.endpoints.processFile+"?step=3",type:"POST",dataType:"json",data:{step:3,fileUpload:{id:this.fileUpload.id,name:this.fileUpload.name,upload_type_id:this.fileUpload.upload_type_id},csvOptions:this.csvOptions,mappings:this.mappings},success:function(e,f,g){b("#step4Continue").prop("disabled",false);b("#step4Continue").removeClass("disabled");d.showSummary(e.importSummary);b("#arenaUploadStep4").show();b("#loadingScreen").html("")},error:function(j,e,i){var f=false;try{if(j&&j.responseText){f=JSON.parse(j.responseText)}}catch(g){f=false}b("#arenaModalLabel").html("Import Data");var h='<p class="text-error"><strong>Failed to import the the data file.</strong></p>';h+="<h4>Web Server Response</h4>";h+="<pre>Status: <strong>"+e+"</strong>\n";h+="Message: <strong>"+i+"</strong>\n</pre>";if(f!==false){h+="<h4>Error Details</h4>";if(f.error=="LOGIN_REQUIRED"){h+="<pre>Error: <strong>Session has expired. Please <a href='#' onClick='document.location.reload(true);return false;'><i class='icon-user'></i> login</a> again.</strong>\n"}else{h+="<pre>Error: <strong>"+f.error+"</strong>\n"}if(f.exception==true){h+="Exception Code: <strong>"+f.errorCode+"</strong>\n";h+="Exception File: <strong>"+f.errorFile+"</strong>\n";h+="Exception Line: <strong>"+f.errorLine+"</strong>\n";if(f.errorInfo!=null){h+="</pre><h4>Database Server Response</h4>";h+="<pre>SQLSTATE Code: <strong>"+f.errorInfo.sqlState+"</strong>\n";h+="Driver Code: <strong>"+f.errorInfo.mysqlError+"</strong>\n";h+="Driver Message: <strong>"+f.errorInfo.message+"</strong>\n"}}h+="</pre>"}else{if(j&&j.responseText){h+="<h4>Error Details</h4>";h+="<pre>Error: <strong>"+j.responseText+"</strong></pre>"}}b("#arenaModalBody").html(h);b("#arenaModal").modal("show");b("#step2Continue").prop("disabled",false);b("#step2Continue").removeClass("disabled");b("#mappingTable").html("");b("#arenaUploadStep2").show();b("#loadingScreen").html("")}});return true};a.onContinueStep4ButtonClick=function(){b("#step4Continue").prop("disabled",true);b("#step4Continue").addClass("disabled");b("#ArenaUploadForm_fileName").fineUploader("clearStoredFiles");b("#mappingTable").html("");b("#arenaUploadStep4").hide();this.clearSummary();b("#arenaUploadStep1").show();return true};a.setLoadingScreen=function(d){var e='<div id="loading"><img src="'+this.baseUrl+'/images/ajax-loader-roller-bg_red-fg_blue.gif"alt="Loading..." /><br />Please wait...</div>';b(d).html(e);return e};a.setupMappingTable=function(d){var k=this;var e="<thead><tr><th>Table Column</th><th>Data File Column</th><th>Data File Example</th></tr></thead><tbody></tbody>";b(d).append(e);var m=b(d).find("tbody");var l=true;for(var h=0;h<this.tableFields.length;h++){if(l===true){e='<tr class="odd" rel="tooltip" title="'+this.tableFields[h].tooltip+'">';l=false}else{e='<tr class="even" rel="tooltip" title="'+this.tableFields[h].tooltip+'">';l=true}e+='<td id="'+this.tableFields[h].name+'">';e+=this.tableFields[h].name+" ";if(this.tableFields[h].required===true){e+='<span class="required">*</span>'}e+="</td>";e+='<td id="'+this.tableFields[h].name+'SelectField">';e+='<select class="span5" id="'+this.tableFields[h].name+'SelectList" data-index="'+h+'">';e+='<option value="Not Mapped">Not Mapped</option>';var g=false;for(var f=0;f<this.csvFields.length;f++){e+='<option value="'+this.csvFields[f]+'"';if(this.csvFields[f]===this.tableFields[h].name){e+=" selected>";g=true}else{e+=">"}e+=this.csvFields[f]+"</option>"}e+="</select>";e+="</td>";e+='<td id="'+this.tableFields[h].name+'PreviewField">';if(g===true){e+=(this.csvRows[0])[this.tableFields[h].name]}e+="</td>";e+="</tr>";m.append(e);b("#"+this.tableFields[h].name+"SelectList").on("change",function(){if(this.value==="Not Mapped"){b("#"+k.tableFields[b(this).data("index")].name+"PreviewField").html("")}else{b("#"+k.tableFields[b(this).data("index")].name+"PreviewField").html((k.csvRows[0])[this.value])}k.checkStep3Button()})}this.checkStep3Button()};a.checkStep3Button=function(){var d=b("#step3Continue").prop("disabled");if(typeof d==="undefined"){d=false}var f=true;for(var e=0;e<this.tableFields.length;e++){if(this.tableFields[e].required===true){if(b("#"+this.tableFields[e].name+"SelectList").val()==="Not Mapped"){f=false}}}if(d===false&&f===false){b("#step3Continue").prop("disabled",true);b("#step3Continue").addClass("disabled")}else{if(d===true&&f===true){b("#step3Continue").prop("disabled",false);b("#step3Continue").removeClass("disabled")}}};a.getMappings=function(){this.mappings=new Array();for(var d=0;d<this.tableFields.length;d++){if(b("#"+this.tableFields[d].name+"SelectList").val()!=="Not Mapped"){this.mappings.push({fieldName:this.tableFields[d].name,headerName:b("#"+this.tableFields[d].name+"SelectList").val(),fieldType:this.tableFields[d].type,fieldSize:this.tableFields[d].size,fieldRequired:this.tableFields[d].required})}}};a.showSummary=function(d){b("#arenaSummaryUpdated").html("<strong>"+d.totalUpdated+"</strong>");b("#arenaSummaryCreated").html("<strong>"+d.totalInserted+"</strong>");b("#arenaSummaryTotal").html("<strong>"+d.totalRecords+"</strong>");if(d.autoTagged){b("#arenaSummaryAutoTagged").addClass("text-success");b("#arenaSummaryAutoTagged").html("<strong>Yes</strong>")}else{b("#arenaSummaryAutoTagged").addClass("text-error");b("#arenaSummaryAutoTagged").html("<strong>No</strong>")}};a.clearSummary=function(){b("#arenaSummaryUpdated").html("");b("#arenaSummaryCreated").html("");b("#arenaSummaryTotal").html("");b("#arenaSummaryAutoTagged").html("");b("#arenaSummaryAutoTagged").removeClass("text-success");b("#arenaSummaryAutoTagged").removeClass("text-error")};a.reset=function(){b("#step4Continue").prop("disabled",true);b("#step4Continue").addClass("disabled");b("#arenaUploadStep4").hide();this.clearSummary();b("#step3Previous").prop("disabled",true);b("#step3Previous").addClass("disabled");b("#step3Continue").prop("disabled",true);b("#step3Continue").addClass("disabled");b("#arenaUploadStep3").hide();b("#mappingTable").html("");b("#step2Continue").prop("disabled",true);b("#step2Continue").addClass("disabled");b("#arenaUploadStep2").hide();b("#ArenaUploadForm_fileName").fineUploader("clearStoredFiles");b("#uploadButton").prop("disabled",true);b("#uploadButton").addClass("disabled");b("#deleteButton").prop("disabled",true);b("#deleteButton").addClass("disabled");b("#arenaUploadStep1").show()};a.onResetButtonClick=function(){this.reset();b("#arenaModal").modal("hide");return true}}(window.uploadArenas=window.uploadArenas||{},jQuery));